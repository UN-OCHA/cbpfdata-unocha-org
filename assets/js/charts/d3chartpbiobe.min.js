(()=>{(function(){let zt=window.navigator.userAgent.indexOf("MSIE")>-1||window.navigator.userAgent.indexOf("Trident")>-1,yt=window.fetch,xt=window.URLSearchParams,de=window.matchMedia("(pointer: coarse)").matches&&!window.matchMedia("(any-pointer: fine)").matches,Dt=window.location.hostname==="cbpf.data.unocha.org",Ht=window.location.hostname+window.location.pathname==="cbpf.data.unocha.org/bookmark.html",jt="https://use.fontawesome.com/releases/v5.6.3/css/all.css",pe=["https://cbpfgms.github.io/css/d3chartstyles.css","https://cbpfgms.github.io/css/d3chartstylespbiobe.css",jt],ut="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js",Nt="https://cbpfgms.github.io/libraries/html2canvas.min.js",Wt="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js",Pt="https://cdn.jsdelivr.net/npm/@ungap/url-search-params@0.1.2/min.min.js",Ut="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js",Zt="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.4/fetch.min.js";if(pe.forEach(function(y){if(!ue(y)){let p=document.createElement("link");p.setAttribute("rel","stylesheet"),p.setAttribute("type","text/css"),p.setAttribute("href",y),y===jt&&(p.setAttribute("integrity","sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"),p.setAttribute("crossorigin","anonymous")),document.getElementsByTagName("head")[0].appendChild(p)}}),!St(ut))yt&&xt?Z(ut,at):yt&&!xt?Z(Pt,function(){Z(ut,at)}):Z(Ut,function(){Z(Zt,function(){Z(Pt,function(){Z(ut,at)})})});else if(typeof d3<"u")yt&&xt?at():yt&&!xt?Z(Pt,at):Z(Ut,function(){Z(Zt,function(){Z(Pt,at)})});else{let y,p=document.getElementsByTagName("script");for(let j=p.length;j--;)p[j].src==ut&&(y=p[j]);y.addEventListener("load",at)}function Z(y,p){let j=document.getElementsByTagName("head")[0],nt=document.createElement("script");nt.type="text/javascript",nt.src=y,nt.onreadystatechange=p,nt.onload=p,j.appendChild(nt)}function ue(y){let p=document.getElementsByTagName("link");for(let j=p.length;j--;)if(p[j].href==y)return!0;return!1}function St(y){let p=document.getElementsByTagName("script");for(let j=p.length;j--;)if(p[j].src==y)return!0;return!1}function at(){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null)throw new TypeError('"this" is null or not defined');var a=Object(this),n=a.length>>>0;if(typeof e!="function")throw new TypeError("predicate must be a function");for(var l=arguments[1],t=0;t<n;){var o=a[t];if(e.call(l,o,t,a))return o;t++}},configurable:!0,writable:!0}),Math.log10=Math.log10||function(e){return Math.log(e)*Math.LOG10E},HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,a,n){var l=this.toDataURL(a,n).split(",")[1];setTimeout(function(){for(var t=atob(l),o=t.length,d=new Uint8Array(o),D=0;D<o;D++)d[D]=t.charCodeAt(D);e(new Blob([d],{type:a||"image/png"}))})}});let y=900,p=[8,8,38,8],j=60,nt=30,wt=8,ft=4,_t=.3,Lt=370,I=14,Je=d3.format("~s"),qe=d3.format(",.0f"),ot=d3.format(".0%"),fe=d3.format(".2%"),Ke=d3.format(".3s"),$t=d3.format(","),he=d3.format(".1s"),Ct="#1F69B3",ge="#F79A3B",Jt=25,kt=4,qt=3,be=-28,me=-34,ye=-42,Kt=.9,xe=278,Qt=.6,Q=d3.local(),Pe="Targeted and Reached People Overview",we="affected-persons-trends",Ce="https://cbpf.data.unocha.org/bookmark.html?",ve="https://gms.unocha.org/content/targeted-and-reached-people",Gt=new Date,Rt=Gt.getFullYear(),Ae=6e5,Ft=d3.utcFormat("_%Y%m%d_%H%M%S_UTC"),et=p[0]+j+nt+2*wt+Lt+p[2],Yt=["total","men","women","boys","girls"],Te=window.innerHeight,J=1e3,Be=["People Reached","People Targeted"],E={},r={selectedYear:[],selectedCbpfs:null,cbpfsInData:[]},it={total:{bodyDAttribute:"M 6.995 18.083 L 6.995 26.833 C 6.995 27.478 6.473 28 5.828 28 C 5.184 28 4.662 27.478 4.662 26.833 L 4.662 8.75 C 3.193 9.578 2.298 11.147 2.333 12.833 C 2.333 13.478 1.811 14 1.167 14 C 0.522 14 0 13.478 0 12.833 C 0 8.959 2.908 6.099 6.995 5.85 L 7 18.083 L 6.995 18.083 L 6.995 18.083 Z  M 8.167 20.417 L 8.167 26.833 C 8.167 27.478 8.689 28 9.333 28 C 9.978 28 10.5 27.478 10.5 26.833 L 10.5 20.417 L 11.667 20.417 C 11.825 20.431 11.982 20.374 12.095 20.262 C 12.208 20.149 12.265 19.992 12.25 19.833 L 9.917 8.75 C 11.647 9.367 12.811 10.996 12.833 12.833 C 12.833 13.478 13.356 14 14 14 C 14.644 14 15.167 13.478 15.167 12.833 C 15.167 8.961 12.255 6.099 8.167 5.85 L 8.167 5.833 L 8.167 20.417 Z",headDAttribute:"M 5.245 2.333 C 5.245 1.046 6.29 0 7.578 0 C 8.866 0 9.912 1.046 9.912 2.333 C 9.912 3.621 8.866 4.667 7.578 4.667 C 6.29 4.667 5.245 3.621 5.245 2.333 Z"},girls:{bodyDAttribute:"M 8 9.185 C 4.766 9.185 2.327 11.486 2.327 14.568 C 2.327 15.038 2.708 15.419 3.178 15.419 C 3.648 15.419 4.029 15.038 4.029 14.568 C 4.021 13.219 4.777 11.981 5.982 11.374 L 4.672 18.186 C 4.652 18.348 4.702 18.51 4.81 18.632 C 4.918 18.754 5.073 18.824 5.235 18.824 L 5.728 18.824 L 5.728 23.649 C 5.728 24.119 6.109 24.5 6.579 24.5 C 7.049 24.5 7.43 24.119 7.43 23.649 L 7.43 18.824 L 8.565 18.824 L 8.565 23.649 C 8.565 24.119 8.947 24.5 9.417 24.5 C 9.887 24.5 10.268 24.119 10.268 23.649 L 10.268 18.824 L 10.76 18.824 C 10.923 18.824 11.078 18.754 11.186 18.632 C 11.294 18.51 11.344 18.348 11.324 18.186 L 10.014 11.371 C 11.221 11.978 11.979 13.217 11.971 14.568 C 11.971 15.038 12.352 15.419 12.822 15.419 C 13.292 15.419 13.673 15.038 13.673 14.568 C 13.673 11.486 11.234 9.185 8 9.185 Z",headDAttribute:"M 5.728 5.77 C 5.728 4.517 6.745 3.5 7.998 3.5 C 9.251 3.5 10.268 4.517 10.268 5.77 C 10.268 7.023 9.251 8.041 7.998 8.041 C 6.745 8.041 5.728 7.023 5.728 5.77 Z"},boys:{bodyDAttribute:"M 8 9.185 C 4.766 9.185 2.327 11.486 2.327 14.568 C 2.327 15.038 2.708 15.419 3.178 15.419 C 3.648 15.419 4.029 15.038 4.029 14.568 C 4.019 13.321 4.666 12.162 5.732 11.515 L 5.732 23.649 C 5.732 24.119 6.113 24.5 6.583 24.5 C 7.053 24.5 7.434 24.119 7.434 23.649 L 7.434 17.689 L 8.569 17.689 L 8.569 23.649 C 8.569 24.119 8.951 24.5 9.421 24.5 C 9.891 24.5 10.272 24.119 10.272 23.649 L 10.272 11.517 C 11.335 12.164 11.981 13.323 11.971 14.568 C 11.971 15.038 12.352 15.419 12.822 15.419 C 13.292 15.419 13.673 15.038 13.673 14.568 C 13.673 11.486 11.234 9.185 8 9.185 Z",headDAttribute:"M 5.732 5.77 C 5.732 4.517 6.749 3.5 8.002 3.5 C 9.255 3.5 10.272 4.517 10.272 5.77 C 10.272 7.023 9.255 8.041 8.002 8.041 C 6.749 8.041 5.732 7.023 5.732 5.77 Z"},women:{bodyDAttribute:"M 7.583 5.833 C 3.185 5.833 0 8.779 0 12.833 C 0 13.478 0.522 14 1.167 14 C 1.811 14 2.333 13.478 2.333 12.833 C 2.333 10.989 3.505 9.348 5.25 8.75 L 2.917 19.833 C 2.902 19.992 2.959 20.149 3.072 20.262 C 3.184 20.374 3.341 20.431 3.5 20.417 L 4.667 20.417 L 4.667 26.833 C 4.667 27.478 5.189 28 5.833 28 C 6.478 28 7 27.478 7 26.833 L 7 20.417 L 8.167 20.417 L 8.167 26.833 C 8.167 27.478 8.689 28 9.333 28 C 9.978 28 10.5 27.478 10.5 26.833 L 10.5 20.417 L 11.667 20.417 C 11.825 20.431 11.982 20.374 12.095 20.262 C 12.208 20.149 12.265 19.992 12.25 19.833 L 9.917 8.75 C 11.647 9.367 12.811 10.996 12.833 12.833 C 12.833 13.478 13.356 14 14 14 C 14.644 14 15.167 13.478 15.167 12.833 C 15.167 8.779 11.976 5.833 7.583 5.833 Z",headDAttribute:"M 5.244 2.333 C 5.244 1.046 6.29 0 7.578 0 C 8.865 0 9.911 1.046 9.911 2.333 C 9.911 3.621 8.865 4.667 7.578 4.667 C 6.29 4.667 5.244 3.621 5.244 2.333 Z"},men:{bodyDAttribute:"M 7.578 5.833 C 3.187 5.833 0 8.777 0 12.833 C 0 13.478 0.522 14 1.167 14 C 1.811 14 2.333 13.478 2.333 12.833 C 2.298 11.147 3.193 9.578 4.662 8.75 L 4.662 26.833 C 4.662 27.478 5.184 28 5.828 28 C 6.473 28 6.995 27.478 6.995 26.833 L 6.995 18.083 L 8.162 18.083 L 8.162 26.833 C 8.162 27.478 8.684 28 9.328 28 C 9.973 28 10.495 27.478 10.495 26.833 L 10.495 8.749 C 11.965 9.577 12.861 11.146 12.826 12.833 C 12.826 13.478 13.348 14 13.993 14 C 14.637 14 15.159 13.478 15.159 12.833 C 15.159 8.777 11.971 5.833 7.578 5.833 Z",headDAttribute:"M 5.245 2.333 C 5.245 1.046 6.29 0 7.578 0 C 8.866 0 9.912 1.046 9.912 2.333 C 9.912 3.621 8.866 4.667 7.578 4.667 C 6.29 4.667 5.245 3.621 5.245 2.333 Z"}},ht=16,vt=28,B,gt=!1,Xt,st,N=new URLSearchParams(location.search);N.has("viz")||N.append("viz",we);let A=d3.select("#d3chartcontainerpbiobe"),De=A.node().getAttribute("data-showhelp")==="true",Se=A.node().getAttribute("data-showlink")==="true",te=A.node().getAttribute("data-title")?A.node().getAttribute("data-title"):Pe,Le=N.has("fund")?N.get("fund").replace(/\|/g,","):A.node().getAttribute("data-cbpf"),ke=N.has("year")?N.get("year").replace(/\|/g,","):A.node().getAttribute("data-year"),Ge=A.node().getAttribute("data-responsive")==="true",Re=A.node().getAttribute("data-lazyload")==="true";Ge==="false"&&A.style("width",y+"px").style("height",et+"px");let bt=A.append("div").attr("class","pbiobeTopDiv"),Fe=bt.append("div").attr("class","pbiobeTitleDiv"),X=bt.append("div").attr("class","pbiobeIconsDiv d3chartIconsDiv"),Mt=A.append("div").attr("class","pbiobeSelectTitleDiv"),At=A.append("div").attr("class","pbiobeSelectDiv"),S=A.append("svg").attr("viewBox","0 0 "+y+" "+et).style("background-color","white");zt&&S.attr("height",et);let Ye=A.append("div").attr("class","pbiobeYearsDescriptionDiv");A.append("div").attr("class","pbiobeDisclaimerCountDiv").html('<p class="text-center" style="font-size:11px; color:#aaa; padding-top: 5px; margin:0"><b>(1) Disclaimer:</b> Figures for people targeted may include double counting as same people may receive assistance from multiple clusters/sectors/projects.<br></p>');let ee=A.append("div").attr("class","pbiobeDisclaimerTotalTargetedDiv"),Me=Dt?null:A.append("div").attr("class","pbiobeFooterDiv");ce(S,y,et,"Loading visualisation...");let ct=A.append("div").attr("id","pbiobeSnapshotTooltip").attr("class","pbiobeSnapshotContent").style("display","none").on("mouseleave",function(){gt=!1,ct.style("display","none"),q.style("display","none"),st&&d3.select(st).dispatch("mouseout")});ct.append("p").attr("id","pbiobeSnapshotTooltipPdfText").html("Download PDF").on("click",function(){gt=!1,Bt("pdf",!0)}),ct.append("p").attr("id","pbiobeSnapshotTooltipPngText").html("Download Image (PNG)").on("click",function(){gt=!1,Bt("png",!0)});let ne=!de&&(window.safari||window.navigator.userAgent.indexOf("Edge")>-1);ne&&ct.append("p").attr("id","pbiobeTooltipBestVisualizedText").html("For best results use Chrome, Firefox, Opera or Chromium-based Edge.").attr("pointer-events","none").style("cursor","default");let q=A.append("div").attr("id","pbiobetooltipdiv").style("display","none");A.on("contextmenu",function(){d3.event.preventDefault();let e=d3.mouse(this);gt=!0,ct.style("display","block").style("top",e[1]-4+"px").style("left",e[0]-4+"px")});let P={main:S.append("g").attr("class","pbiobeTopPanel").attr("transform","translate("+p[3]+","+p[0]+")"),width:y-p[1]-p[3],height:j,padding:[0,0,0,0],pictogramPadding:60,leftPadding:[142,472],mainValueVerPadding:10,mainValueHorPadding:2},u={main:S.append("g").attr("class","pbiobeButtonsPanel").attr("transform","translate("+p[3]+","+(p[0]+P.height+wt)+")"),width:y-p[1]-p[3],height:nt,padding:[0,0,0,56],buttonWidth:54,buttonPadding:4,buttonVerticalPadding:4,arrowPadding:18},G={main:S.append("g").attr("class","pbiobePercentagePanel").attr("transform","translate("+p[3]+","+(p[0]+u.height+P.height+2*wt)+")"),width:(y-p[1]-p[3]-ft)/2,height:Lt,padding:[50,86,4,56],labelPadding:6},_={main:S.append("g").attr("class","pbiobePictogramsPanel").attr("transform","translate("+(p[3]+G.width+ft)+","+(p[0]+u.height+P.height+2*wt)+")"),width:(y-p[1]-p[3]-ft)/2,height:Lt,padding:[50,4,4,4]},Ot=S.append("g").attr("class","pbiobeBottomGroup"),W=d3.scaleLinear().range([G.padding[3],G.width-G.padding[1]]),dt=d3.scaleLinear().range([_.padding[3],_.width-_.padding[1]]),V=d3.scaleBand().range([G.padding[0],G.height-G.padding[2]]).domain(Yt).paddingInner(.4).paddingOuter(.2),ae=d3.scalePoint().range([G.padding[0],G.height-G.padding[2]]).domain(Yt).padding(.5),Oe=d3.axisTop(W).tickSizeOuter(0).tickSizeInner(-(G.height-G.padding[0]-G.padding[2])).tickValues([0,.25,.5,.75,1]).tickFormat(ot),Ie=d3.axisLeft(V).tickFormat(le);if(St(Nt)||Z(Nt,null),St(Wt)||Z(Wt,null),Dt&&!Ht)window.cbpfbiDataObject.targetedPersonsDetailsData.then(e=>It(e));else if(localStorage.getItem("pbiobedata")&&JSON.parse(localStorage.getItem("pbiobedata")).timestamp>Gt.getTime()-Ae){let e=d3.csvParse(JSON.parse(localStorage.getItem("pbiobedata")).data);console.info("pbiobe: data from local storage"),It(e)}else d3.csv("https://cbpfapi.unocha.org/vo2/odata/ProjectSummaryBeneficiaryDetail?$format=csv&ShowAllPooledFunds=1").then(function(e){try{localStorage.setItem("pbiobedata",JSON.stringify({data:d3.csvFormat(e),timestamp:Gt.getTime()}))}catch(a){console.info("D3 chart pbiobe, "+a)}console.info("pbiobe: data from API"),It(e)});function It(e){Et(),B=e.map(function(n){return E["id"+n.PooledFundId]||(E["id"+n.PooledFundId]=n.PooledFundName),+n.AllocationYear}).filter(function(n,l,t){return t.indexOf(n)===l}).sort(function(n,l){return n-l}),je(ke),r.selectedCbpfs=Ne(Le),Re?(d3.select(window).on("scroll.pbiobe",a),d3.select("body").on("d3ChartsYear.pbiobe",function(){r.selectedYear=[re(+d3.event.detail)]}),a()):oe(e);function a(){let n=A.node().getBoundingClientRect();n.bottom<0||n.top-Te>0||(d3.select(window).on("scroll.pbiobe",null),oe(e))}}function oe(e){let{data:a,totalClosedReports:n}=Vt(e);l(),t(),Dt||ze(),o(),D(),d(a,n),Y(a),R(a),F(),se(),De&&ie();function l(){let i=Fe.append("p").attr("id","pbiobed3chartTitle").html(te),h=X.append("button").attr("id","pbiobeHelpButton");h.html("HELP  ").append("span").attr("class","fas fa-info");let s=X.append("button").attr("id","pbiobeDownloadButton");s.html(".CSV  ").append("span").attr("class","fas fa-download");let x=X.append("div").attr("class","pbiobeSnapshotDiv");x.append("button").attr("id","pbiobeSnapshotButton").html("IMAGE ").append("span").attr("class","fas fa-camera");let f=x.append("div").attr("class","pbiobeSnapshotContent"),z=f.append("p").attr("id","pbiobeSnapshotPdfText").html("Download PDF").on("click",function(){Bt("pdf",!1)}),T=f.append("p").attr("id","pbiobeSnapshotPngText").html("Download Image (PNG)").on("click",function(){Bt("png",!1)}),w=X.append("button").datum({clicked:!1}).attr("id","pbiobePlayButton");if(w.html("PLAY  ").append("span").attr("class","fas fa-play"),w.on("click",function(g){g.clicked=!g.clicked,w.html(g.clicked?"PAUSE ":"PLAY  ").append("span").attr("class",g.clicked?"fas fa-pause":"fas fa-play"),g.clicked?(r.selectedYear.length=1,c(),Xt=d3.interval(c,3*J)):Xt.stop();function c(){let v=B.indexOf(r.selectedYear[0]);if(r.selectedYear[0]=B[(v+1)%B.length],d3.selectAll(".pbiobebuttonsRects").filter(function(C){return C===r.selectedYear[0]}).dispatch("click"),B.length>I){let C=r.selectedYear[0]<B[I/2]?0:r.selectedYear[0]>B[B.length-I/2]?B.length-I:B.indexOf(r.selectedYear[0])-I/2,b=-(u.buttonWidth*C);b===0?(S.select(".pbiobeLeftArrowGroup").select("text").style("fill","#ccc"),S.select(".pbiobeLeftArrowGroup").attr("pointer-events","none")):(S.select(".pbiobeLeftArrowGroup").select("text").style("fill","#666"),S.select(".pbiobeLeftArrowGroup").attr("pointer-events","all")),Math.abs(b)>=(B.length-I)*u.buttonWidth?(S.select(".pbiobeRightArrowGroup").select("text").style("fill","#ccc"),S.select(".pbiobeRightArrowGroup").attr("pointer-events","none")):(S.select(".pbiobeRightArrowGroup").select("text").style("fill","#666"),S.select(".pbiobeRightArrowGroup").attr("pointer-events","all")),S.select(".pbiobebuttonsGroup").transition().duration(J).attrTween("transform",function(){return d3.interpolateString(this.getAttribute("transform"),"translate("+b+",0)")})}}}),!Ht){let g=X.append("button").attr("id","pbiobeShareButton");g.html("SHARE  ").append("span").attr("class","fas fa-share");let c=A.append("div").attr("class","d3chartShareDiv").style("display","none");g.on("mouseover",function(){c.html("Click to copy").style("display","block");let v=this.getBoundingClientRect(),O=A.node().getBoundingClientRect(),C=c.node().getBoundingClientRect(),b=v.top-O.top-(C.height-v.height)/2,H=v.left-O.left-C.width-12;c.style("top",b+"px").style("left",H+"20px")}).on("mouseout",function(){c.style("display","none")}).on("click",function(){let v=Ce+N.toString();c.append("input").attr("type","text").attr("readonly",!0).attr("spellcheck","false").property("value",v).node().select(),document.execCommand("copy"),c.html("Copied!");let C=this.getBoundingClientRect(),b=A.node().getBoundingClientRect(),H=c.node().getBoundingClientRect(),M=C.left-b.left-H.width-12;c.style("left",M+"20px")})}if(ne){let g=f.append("p").attr("id","pbiobeBestVisualizedText").html("For best results use Chrome, Firefox, Opera or Chromium-based Edge.").attr("pointer-events","none").style("cursor","default")}x.on("mouseover",function(){f.style("display","block")}).on("mouseout",function(){f.style("display","none")}),Mt.html("Select CBPF and Allocation Year:"),h.on("click",ie),s.on("click",function(){let g=Ve(e),v="AffectedPersons_"+Ft(new Date)+".csv",O=new Blob([g],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(O,filename);else{let C=document.createElement("a");if(C.download!==void 0){let b=URL.createObjectURL(O);C.setAttribute("href",b),C.setAttribute("download",v),C.style="visibility:hidden",document.body.appendChild(C),C.click(),document.body.removeChild(C)}}})}function t(){let i=d3.keys(E);i.unshift("All CBPFs");let h=At.selectAll(null).data(i).enter().append("div").attr("class","pbiobeCheckboxDiv");h.filter(function(T){return T!=="All CBPFs"}).style("opacity",function(T){return r.cbpfsInData.indexOf(T)===-1?Qt:1});let s=h.append("label"),x=s.append("input").attr("type","checkbox").property("checked",function(T){return r.selectedCbpfs.length!==d3.keys(E).length&&r.selectedCbpfs.indexOf(T)>-1}).attr("value",function(T){return T}),k=s.append("span").attr("class","pbiobeCheckboxText").html(function(T){return E[T]||T}),f=h.filter(function(T){return T==="All CBPFs"}).select("input");d3.select(f.node().nextSibling).attr("class","pbiobeCheckboxTextAllCbpfs");let z=h.filter(function(T){return T!=="All CBPFs"}).select("input");z.property("disabled",function(T){return r.cbpfsInData.indexOf(T)===-1}),f.property("checked",function(){return r.selectedCbpfs.length===d3.keys(E).length}),s.select("input").on("change",function(){if(this.value==="All CBPFs")this.checked?(r.selectedCbpfs=d3.keys(E),z.property("checked",!1)):r.selectedCbpfs.length=0;else{if(this.checked)r.selectedCbpfs.length===d3.keys(E).length?r.selectedCbpfs=[this.value]:r.selectedCbpfs.push(this.value);else{let g=r.selectedCbpfs.indexOf(this.value);r.selectedCbpfs.splice(g,1)}f.property("checked",!1)}if(!r.selectedCbpfs.length||r.selectedCbpfs.length===d3.keys(E).length)N.delete("fund");else{let g=r.selectedCbpfs.map(function(c){return E[c]}).join("|");N.has("fund")?N.set("fund",g):N.append("fund",g)}let{data:T,totalClosedReports:w}=Vt(e);d(T,w),Y(T),R(T),F()})}function o(){let i=G.main.append("g").attr("class","pbiobegroupXAxisPercentage").attr("transform","translate(0,"+G.padding[0]+")").call(Oe);G.main.append("g").attr("class","pbiobegroupYAxisPercentage").attr("transform","translate("+G.padding[3]+",0)").call(Ie).selectAll(".tick").filter(function(s){return s==="total"}).select("text").style("font-weight","bold").style("fill","#333")}function d(i,h){let s=i.find(function(M){return M.beneficiary==="total"}),x=h.targeted,k=s.actual,f=h.percentage;Ue(h.targeted,s.targeted,s.percentage);let z=P.main.selectAll(".pbiobetopPanelPictogram").data([!0]).enter().append("g").attr("class","pbiobetopPanelPictogram contributionColorFill").attr("transform","translate("+P.pictogramPadding+",2) scale(2)").each(function(M,K,U){["bodyDAttribute","headDAttribute"].forEach(function(m){d3.select(U[K]).append("path").attr("d",it.total[m])})}),T=d3.select(".pbiobetopPanelMainValue").size()!==0?d3.select(".pbiobetopPanelMainValue").datum():0,w=d3.select(".pbiobetopPanelPersonsActual").size()!==0?d3.select(".pbiobetopPanelPersonsActual").datum():0,g=P.main.selectAll(".pbiobemainValueGroup").data([!0]);g=g.enter().append("g").attr("class","pbiobemainValueGroup").merge(g);let c=g.selectAll(".pbiobetopPanelMainValue").data([x]);c=c.enter().append("text").attr("class","pbiobetopPanelMainValue contributionColorFill").attr("text-anchor","end").merge(c).attr("y",P.height-P.mainValueVerPadding).attr("x",P.pictogramPadding+P.leftPadding[0]-P.mainValueHorPadding),c.transition().duration(J).tween("text",function(M){let K=this,U=d3.interpolate(T,M);return function(m){let lt=rt(U(m));K.textContent=M<1e3?lt:lt.substring(0,lt.length-1)}});let v=g.selectAll(".pbiobetopPanelMainText").data([x]);v=v.enter().append("text").attr("class","pbiobetopPanelMainText").attr("text-anchor","start").attr("y",P.height-P.mainValueVerPadding*3.1).attr("x",P.pictogramPadding+P.leftPadding[0]+P.mainValueHorPadding).merge(v).text(function(M){let K=rt(M),U=K[K.length-1];return(U==="k"?"Thousand":U==="M"?"Million":U==="G"?"Billion":"")+" People"}).append("tspan").attr("dy",-8).style("font-size","0.6em").text(` (1${h.targeted!==s.targeted?", 2":""})`);let O=g.selectAll(".pbiobetopPanelSubText").data([!0]);O=O.enter().append("text").attr("class","pbiobetopPanelSubText").attr("text-anchor","start").attr("y",P.height-P.mainValueVerPadding*1.2).attr("x",P.pictogramPadding+P.leftPadding[0]+P.mainValueHorPadding).merge(O).text(function(){return"Targeted in "+(r.selectedYear.length===1?r.selectedYear[0]:"years*")});let C=g.selectAll(".pbiobetopPanelPersonsActual").data([k]);C=C.enter().append("text").attr("class","pbiobetopPanelPersonsActual contributionColorFill").attr("text-anchor","end").merge(C).attr("y",P.height-P.mainValueVerPadding).attr("x",P.pictogramPadding+P.leftPadding[1]-P.mainValueHorPadding),C.transition().duration(J).tween("text",function(M){let K=this,U=d3.interpolate(w,M);return function(m){let lt=rt(U(m));K.textContent=M<1e3?lt:lt.substring(0,lt.length-1)}});let b=g.selectAll(".pbiobetopPanelPersonsText").data([k]);b=b.enter().append("text").attr("class","pbiobetopPanelPersonsText").attr("text-anchor","start").attr("y",P.height-P.mainValueVerPadding*3.1).attr("x",P.pictogramPadding+P.leftPadding[1]+P.mainValueHorPadding).merge(b).text(function(M){let K=rt(M),U=K[K.length-1];return(U==="k"?"Thousand":U==="M"?"Million":U==="G"?"Billion":"")+" People"}).append("tspan").attr("dy",-8).style("font-size","0.6em").text(` (1${h.targeted!==s.targeted?", 2":""})`);let H=g.selectAll(".pbiobetopPanelPersonsTextSubText").data([!0]);H=H.enter().append("text").attr("class","pbiobetopPanelPersonsTextSubText").attr("y",P.height-P.mainValueVerPadding*1.2).attr("x",P.pictogramPadding+P.leftPadding[1]+P.mainValueHorPadding).attr("text-anchor","start").merge(H).text(function(){return"Reached in "+(r.selectedYear.length===1?r.selectedYear[0]:"years*")+" ("+ot(f)+")"})}function D(){let i=u.main.append("clipPath").attr("id","pbiobeclipPathButtons").append("rect").attr("width",I*u.buttonWidth).attr("height",u.height),h=u.main.append("g").attr("class","pbiobeClipPathGroup").attr("transform","translate("+u.padding[3]+",0)").attr("clip-path","url(#pbiobeclipPathButtons)"),s=h.append("g").attr("class","pbiobebuttonsGroup").attr("transform","translate(0,0)").style("cursor","pointer"),x=s.selectAll(null).data(B).enter().append("rect").attr("rx","2px").attr("ry","2px").attr("class","pbiobebuttonsRects").attr("width",u.buttonWidth-u.buttonPadding).attr("height",u.height-u.buttonVerticalPadding*2).attr("y",u.buttonVerticalPadding).attr("x",function(b,H){return H*u.buttonWidth+u.buttonPadding/2}).style("fill",function(b){return r.selectedYear.indexOf(b)>-1?Ct:"#eaeaea"}),k=s.selectAll(null).data(B).enter().append("text").attr("text-anchor","middle").attr("class","pbiobebuttonsText").style("user-select","none").attr("y",u.height/1.6).attr("x",function(b,H){return H*u.buttonWidth+u.buttonWidth/2}).style("fill",function(b){return r.selectedYear.indexOf(b)>-1?"white":"#444"}).text(function(b){return b}),f=u.main.append("g").attr("class","pbiobeLeftArrowGroup").style("cursor","pointer").style("opacity",0).attr("pointer-events","none").attr("transform","translate("+u.padding[3]+",0)"),z=f.append("rect").style("fill","white").attr("width",u.arrowPadding).attr("height",u.height-u.padding[0]-u.buttonVerticalPadding*2).attr("y",u.buttonVerticalPadding),T=f.append("text").attr("class","pbiobeleftArrowText").attr("x",0).attr("y",u.height-u.buttonVerticalPadding*2.1).style("fill","#666").text("\u25C4"),w=u.main.append("g").attr("class","pbiobeRightArrowGroup").style("cursor","pointer").style("opacity",0).attr("pointer-events","none").attr("transform","translate("+(u.padding[3]+u.arrowPadding+I*u.buttonWidth)+",0)"),g=w.append("rect").style("fill","white").attr("width",u.arrowPadding).attr("height",u.height-u.padding[0]-u.buttonVerticalPadding*2).attr("y",u.buttonVerticalPadding),c=w.append("text").attr("class","pbioberightArrowText").attr("x",-1).attr("y",u.height-u.buttonVerticalPadding*2.1).style("fill","#666").text("\u25BA");B.length>I&&(h.attr("transform","translate("+(u.padding[3]+u.arrowPadding)+",0)"),w.style("opacity",1).attr("pointer-events","all"),f.style("opacity",1).attr("pointer-events","all"),C(),O(),f.on("click",function(){f.attr("pointer-events","none");let b=Tt(s.attr("transform"))[0];w.select("text").style("fill","#666"),w.attr("pointer-events","all"),s.transition().duration(J).attr("transform","translate("+Math.min(0,b+I*u.buttonWidth)+",0)").on("end",v)}),w.on("click",function(){w.attr("pointer-events","none");let b=Tt(s.attr("transform"))[0];f.select("text").style("fill","#666"),f.attr("pointer-events","all"),s.transition().duration(J).attr("transform","translate("+Math.max(-((B.length-I)*u.buttonWidth),-(Math.abs(b)+I*u.buttonWidth))+",0)").on("end",v)})),x.on("mouseover",tt).on("mouseout",pt).on("click",function(b){let H=this;if(d3.event.altKey){L(b,!1);return}Q.get(this)!=="clicked"?(Q.set(this,"clicked"),setTimeout(function(){Q.get(H)==="clicked"&&L(b,!0),Q.set(H,null)},250)):(L(b,!1),Q.set(this,null))}),d3.select("body").on("d3ChartsYear.pbiobe",function(){L(re(+d3.event.detail),!0),B.length>I&&(C(),v())});function v(){let b=Tt(s.attr("transform"))[0];b===0?(f.select("text").style("fill","#ccc"),f.attr("pointer-events","none")):(f.select("text").style("fill","#666"),f.attr("pointer-events","all")),Math.abs(b)>=(B.length-I)*u.buttonWidth?(w.select("text").style("fill","#ccc"),w.attr("pointer-events","none")):(w.select("text").style("fill","#666"),w.attr("pointer-events","all"))}function O(){let b=Tt(s.attr("transform"))[0];b===0&&(f.select("text").style("fill","#ccc"),f.attr("pointer-events","none")),Math.abs(b)>=(B.length-I)*u.buttonWidth&&(w.select("text").style("fill","#ccc"),w.attr("pointer-events","none"))}function C(){let b=r.selectedYear[0]<B[I/2]?0:r.selectedYear[0]>B[B.length-I/2]?B.length-I:B.indexOf(r.selectedYear[0])-I/2;s.attr("transform","translate("+-(u.buttonWidth*b)+",0)")}}function Y(i){let h=G.main.selectAll(".pbiobePercentagePanelTitle").data([!0]).enter().append("text").attr("class","pbiobePercentagePanelTitle").attr("x",G.padding[3]).attr("y",G.padding[0]-Jt).text("People Reached, in percentage"),s=G.main.selectAll(".pbiobeBeneficiaryGroup").data(i,function(c){return c.beneficiary}),x=s.exit().remove(),k=s.enter().append("g").attr("class","pbiobeBeneficiaryGroup"),f=k.append("rect").attr("class","obiobeBackgroundBars").attr("x",function(c){return W(0)}).attr("y",function(c){return V(c.beneficiary)}).attr("height",V.bandwidth()).attr("width",W(1)-W(0)).style("fill","#ccc"),z=k.append("rect").attr("class","pbiobeBars").attr("x",function(c){return W(0)}).attr("y",function(c){return V(c.beneficiary)}).attr("height",V.bandwidth()).attr("width",0).classed("contributionColorFill",!0),T=k.append("text").attr("class","pbiobeBarsPercentage").attr("y",function(c){return V(c.beneficiary)+V.bandwidth()/2+kt}).attr("x",W(0)+qt).style("fill","#666").text(ot(0)),w=k.append("text").attr("class","pbiobeBarsTotalLine1").classed("contributionColorFill",!0).attr("x",W(1)+kt).attr("y",function(c){return V(c.beneficiary)+V.bandwidth()*.4}).text(0),g=k.append("text").attr("class","pbiobeBarsTotalLine2").attr("x",W(1)+kt).attr("y",function(c){return V(c.beneficiary)+V.bandwidth()*.8}).text(0);s=k.merge(s),s.select(".pbiobeBars").transition().duration(J).attr("width",function(c){return W(Math.min(c.percentage,1))-W(0)}),s.select(".pbiobeBarsPercentage").transition().duration(J).attr("x",function(c){return c.percentage<Kt?W(Math.min(c.percentage,1))+qt:parseInt(ot(c.percentage))===100?W(Math.min(c.percentage,1))+me:c.percentage>1?W(Math.min(c.percentage,1))+ye:W(Math.min(c.percentage,1))+be}).style("fill",function(c){return c.percentage<Kt?"#666":"whitesmoke"}).tween("text",function(c){let v=this,O=+v.textContent.replace(/\D/g,"")/100,C=d3.interpolate(O||0,Math.min(c.percentage,1));return function(b){d3.select(v).text(c.percentage>1?">"+ot(C(b)):ot(C(b)))}}),s.select(".pbiobeBarsTotalLine1").transition().duration(J).tween("text",function(c){let v=this,O=+v.textContent.replace(/\D/g,""),C=d3.interpolate(O||0,c.actual);return function(b){d3.select(v).text(rt(~~C(b))).append("tspan").attr("class","pbiobeBarsTotalSpan").text(" out of")}}),s.select(".pbiobeBarsTotalLine2").transition().duration(J).tween("text",function(c){let v=this,O=+v.textContent.replace(/\D/g,""),C=d3.interpolate(O||0,c.targeted);return function(b){d3.select(v).text(rt(~~C(b)))}})}function R(i){dt.domain([0,i.find(function(m){return m.beneficiary==="total"}).targeted]);let h=_.main.selectAll(".pbiobePictogramsPanelTitle").data([!0]).enter().append("text").attr("class","pbiobePictogramsPanelTitle").attr("x",_.padding[3]).attr("y",_.padding[0]-Jt).text("People Reached, real proportions"),s=_.main.selectAll(".pbiobePictogramGroupGray").data(i,function(m){return m.beneficiary}),x=s.exit().remove(),k=s.enter().append("g").attr("class","pbiobePictogramGroupGray").attr("clip-path",function(m){return"url(#pbiobeClipPathGray"+m.beneficiary+")"}).attr("transform",function(m){return Q.set(this,m.beneficiary),"translate(0,"+(ae(m.beneficiary)-vt/2)+")"}),f=k.append("clipPath").attr("id",function(m){return"pbiobeClipPathGray"+m.beneficiary}).append("rect").attr("width",0).attr("height",V.bandwidth()),z=k.selectAll(".pbiobePathGroupGray").data(d3.range(~~(_.width/ht))).enter().append("g").attr("class","pbiobePathGroupGray").attr("transform",function(m){return"translate("+m*ht+",0)"}),T=z.append("path").attr("d",function(m){return it[Q.get(this)].headDAttribute}).style("fill","#ccc"),w=z.append("path").attr("d",function(m){return it[Q.get(this)].bodyDAttribute}).style("fill","#ccc");s=k.merge(s),s.select("clipPath rect").transition().duration(J).attr("width",function(m){return dt(m.targeted)-dt(0)});let g=_.main.selectAll(".pbiobePictogramGroupBlue").data(i,function(m){return m.beneficiary}),c=g.exit().remove(),v=g.enter().append("g").attr("class","pbiobePictogramGroupBlue").attr("clip-path",function(m){return"url(#pbiobeClipPathBlue"+m.beneficiary+")"}).attr("transform",function(m){return Q.set(this,m.beneficiary),"translate(0,"+(ae(m.beneficiary)-vt/2)+")"}),O=v.append("clipPath").attr("id",function(m){return"pbiobeClipPathBlue"+m.beneficiary}).append("rect").attr("width",0).attr("height",V.bandwidth()),C=v.selectAll(".pbiobePathGroupBlue").data(d3.range(~~(_.width/ht))).enter().append("g").attr("class","pbiobePathGroupBlue").attr("transform",function(m){return"translate("+m*ht+",0)"}),b=C.append("path").attr("d",function(m){return it[Q.get(this)].headDAttribute}).classed("contributionColorFill",!0),H=C.append("path").attr("d",function(m){return it[Q.get(this)].bodyDAttribute}).classed("contributionColorFill",!0);g=v.merge(g),g.select("clipPath rect").transition().duration(J).attr("width",function(m){return dt(m.actual)-dt(0)});let M=_.main.selectAll(".pbiobePictogramRect").data(i,function(m){return m.beneficiary}),K=M.exit().remove();M=M.enter().append("rect").attr("class","pbiobePictogramRect").attr("x",0).attr("y",function(m){return V(m.beneficiary)}).attr("height",V.bandwidth()).attr("width",_.width).style("opacity",0).attr("pointer-events","all").merge(M)}function F(){let i=Ot.selectAll(".pbiobeLegendGroup").data(Be).enter().append("g").attr("class","pbiobeLegendGroup").attr("transform",function(w,g){return"translate("+(p[3]+G.padding[3]+130*g)+","+(et-p[2]+6)+")"}),h=i.append("rect").attr("width",14).attr("height",14).attr("fill","#ccc").classed("contributionColorFill",function(w,g){return!g}),s=i.append("text").attr("x",18).attr("y",10).text(function(w){return w}).append("tspan").attr("dy",-4).style("font-size","0.8em").text(" (1)"),x=Ot.selectAll(".pbiobePictogramLegendGroup").data([!0]).enter().append("g").attr("class","pbiobePictogramLegendGroup").attr("transform",function(){return"translate("+(p[3]+G.width+ft)+","+(et-p[2]+8)+")"}),k=x.append("path").attr("d",it.total.headDAttribute).style("fill","#666").attr("transform","translate(0,"+-vt/5+") scale(0.7,0.7)"),f=x.append("path").attr("d",it.total.bodyDAttribute).style("fill","#666").attr("transform","translate(0,"+-vt/5+") scale(0.7,0.7)"),z=Ot.selectAll(".pbiobePictogramLegendText").data([dt.domain()[1]]);z=z.enter().append("text").attr("class","pbiobePictogramLegendText").attr("x",p[3]+G.width+ft+12).attr("y",et-p[2]+16).merge(z).text(function(w){let g=T(w/~~(_.width/ht));return g?": approx. "+g+" people":": no people"});function T(w){let g=he(w),c=g[g.length-1],v=c==="k"?" thousand":c==="M"?" million":c==="G"?" billion":"";return g.slice(0,-1)+v}}function L(i,h){if(h)r.selectedYear=[i];else{let f=r.selectedYear.indexOf(i);if(f>-1){if(r.selectedYear.length===1)return;r.selectedYear.splice(f,1)}else r.selectedYear.push(i)}let s=r.selectedYear.map(function(f){return f}).join("|");N.has("year")?N.set("year",s):N.append("year",s),d3.selectAll(".pbiobebuttonsRects").style("fill",function(f){return r.selectedYear.indexOf(f)>-1?Ct:"#eaeaea"}),d3.selectAll(".pbiobebuttonsText").style("fill",function(f){return r.selectedYear.indexOf(f)>-1?"white":"#444"}),se();let{data:x,totalClosedReports:k}=Vt(e);At.selectAll(".pbiobeCheckboxDiv").filter(function(f){return f!=="All CBPFs"}).select("input").property("disabled",function(f){return r.cbpfsInData.indexOf(f)===-1}),At.selectAll(".pbiobeCheckboxDiv").filter(function(f){return f!=="All CBPFs"}).style("opacity",function(f){return r.cbpfsInData.indexOf(f)===-1?Qt:1}),d(x,k),Y(x),R(x),F()}S.selectAll(".pbiobeBeneficiaryGroup, .pbiobePictogramRect").on("mouseover",mt).on("mouseout",$);function tt(i){q.style("display","block").html(null),q.append("div").style("max-width","200px").attr("id","pbiobeInnerTooltipDiv").html("Click for selecting a single year. Double-click or ALT + click for selecting multiple years.");let s=A.node().getBoundingClientRect(),x=this.getBoundingClientRect();tooltipSize=q.node().getBoundingClientRect(),q.style("left",x.left+x.width/2-s.left>s.width-tooltipSize.width/2-p[1]?s.width-tooltipSize.width-p[1]+"px":x.left+x.width/2-s.left<tooltipSize.width/2+u.padding[3]+p[0]?u.padding[3]+p[0]+"px":x.left+x.width/2-s.left-tooltipSize.width/2+"px").style("top",x.top+x.height/2-s.top<tooltipSize.height?x.top-s.top+x.height+2+"px":x.top-s.top-tooltipSize.height-4+"px"),d3.select(this).style("fill",Ct),d3.select(this.parentNode).selectAll("text").filter(function(k){return k===i}).style("fill","white")}function pt(i){q.style("display","none"),!(r.selectedYear.indexOf(i)>-1)&&(d3.select(this).style("fill","#eaeaea"),d3.selectAll(".pbiobebuttonsText").filter(function(h){return h===i}).style("fill","#444"))}function mt(i){st=this,S.selectAll(".pbiobeBeneficiaryGroup, .pbiobePictogramGroupGray, .pbiobePictogramGroupBlue").style("opacity",function(w){return w.beneficiary===i.beneficiary?1:_t}),S.select(".pbiobegroupYAxisPercentage").selectAll(".tick text").style("opacity",function(w){return w===i.beneficiary?1:_t});let h=i.targeted?"("+(i.beneficiary==="total"?"people":i.beneficiary)+" reached: <strong>"+fe(i.actual/i.targeted)+"</strong> of the target)":"";q.style("display","block").html("<strong>"+le(i.beneficiary)+"</strong><br><div style='margin:8px 0px 8px 0px;display:flex;flex-wrap:wrap;align-items:center;width:"+xe+"px;'><div style='display:flex;margin-bottom:4px;flex:0 65%;white-space:initial;'>Number of "+(i.beneficiary==="total"?"people":i.beneficiary)+" targeted:</div><div style='display:flex;margin-bottom:4px;flex:0 35%;justify-content:flex-end;'><strong>"+$t(i.targeted)+"</strong></div><div style='display:flex;margin-bottom:4px;flex:0 65%;white-space:initial;'>Number of "+(i.beneficiary==="total"?"people":i.beneficiary)+" reached:</div><div style='display:flex;margin-bottom:4px;flex:0 35%;justify-content:flex-end;'><strong>"+$t(i.actual)+"</strong></div></div><div>"+h+"</div>");let s=this.getBoundingClientRect(),x=A.node().getBoundingClientRect(),k=q.node().getBoundingClientRect(),f=s.top-x.top,z=s.left-x.left+(s.width-k.width)/2,T=d3.mouse(S.node());q.style("left",z+"px").style("top",T[1]>et-k.height-V.bandwidth()?f-k.height-6+"px":f+V.bandwidth()+4+"px")}function $(){gt||(st=null,S.selectAll(".pbiobeBeneficiaryGroup, .pbiobePictogramGroupGray, .pbiobePictogramGroupBlue").style("opacity",1),S.select(".pbiobegroupYAxisPercentage").selectAll(".tick text").style("opacity",1),q.style("display","none"))}}function Vt(e){r.cbpfsInData.length=0,e.forEach(function(o){r.selectedYear.indexOf(+o.AllocationYear)>-1&&r.cbpfsInData.indexOf("id"+o.PooledFundId)===-1&&r.cbpfsInData.push("id"+o.PooledFundId)});let n=e.filter(function(o){return r.selectedYear.indexOf(+o.AllocationYear)>-1&&r.selectedCbpfs.indexOf("id"+o.PooledFundId)>-1}).reduce(function(o,d){return o.boysActual+=+d.ActualBoys,o.boysTargeted+=+d.PlannedBoys,o.girlsActual+=+d.ActualGirls,o.girlsTargeted+=+d.PlannedGirls,o.menActual+=+d.ActualMen,o.menTargeted+=+d.PlannedMen,o.womenActual+=+d.ActualWomen,o.womenTargeted+=+d.PlannedWomen,o.totalActual+=+d.ActualTotal,o.totalTargeted+=+d.PlannedTotal,o.totalTargetedClosedReports+=+d.ActualTotal!=0?+d.PlannedTotal:0,o},{boysActual:0,boysTargeted:0,girlsActual:0,girlsTargeted:0,menActual:0,menTargeted:0,womenActual:0,womenTargeted:0,totalActual:0,totalTargeted:0,totalTargetedClosedReports:0}),l=Yt.map(function(o){let d=n[o+"Targeted"]!==0?n[o+"Actual"]/n[o+"Targeted"]:n[o+"Actual"]===0?0:Math.PI;return{beneficiary:o,targeted:n[o+"Targeted"],actual:n[o+"Actual"],percentage:d}}),t={targeted:n.totalTargetedClosedReports,percentage:n.totalActual/n.totalTargetedClosedReports||0};return{data:l,totalClosedReports:t}}function Ve(e){let a=Ee(e).sort(function(o,d){return+d.Year-+o.Year||(o["CBPF Name"].toLowerCase()<d["CBPF Name"].toLowerCase()?-1:o["CBPF Name"].toLowerCase()>d["CBPF Name"].toLowerCase()?1:0)}),n=Object.keys(a[0]),l=function(o,d){return d===null?"":d},t=a.map(function(o){return n.map(function(d){return JSON.stringify(o[d],l)}).join(",")});return t.unshift(n.join(",")),t.join(`\r
`)}function Ee(e){let a=e.filter(function(l){return r.selectedYear.indexOf(+l.AllocationYear)>-1&&r.selectedCbpfs.indexOf("id"+l.PooledFundId)>-1}),n=[];return a.forEach(function(l){let t=n.find(function(o){return o.Year===+l.AllocationYear&&o["CBPF Name"]===l.PooledFundName});t?(t["Boys (Reached)"]+=+l.ActualBoys,t["Boys (Targeted)"]+=+l.PlannedBoys,t["Girls (Reached)"]+=+l.ActualGirls,t["Girls (Targeted)"]+=+l.PlannedGirls,t["Men (Reached)"]+=+l.ActualMen,t["Men (Targeted)"]+=+l.PlannedMen,t["Women (Reached)"]+=+l.ActualWomen,t["Women (Targeted)"]+=+l.PlannedWomen,t["Total (Reached)"]+=+l.ActualTotal,t["Total (Targeted)"]+=+l.PlannedTotal):n.push({Year:+l.AllocationYear,"CBPF Name":l.PooledFundName,"Boys (Reached)":+l.ActualBoys,"Boys (Targeted)":+l.PlannedBoys,"Girls (Reached)":+l.ActualGirls,"Girls (Targeted)":+l.PlannedGirls,"Men (Reached)":+l.ActualMen,"Men (Targeted)":+l.PlannedMen,"Women (Reached)":+l.ActualWomen,"Women (Targeted)":+l.PlannedWomen,"Total (Reached)":+l.ActualTotal,"Total (Targeted)":+l.PlannedTotal})}),n}function ze(){let e="\xA9 OCHA CBPF Section "+Rt;Se&&(e+=" | For more information, please visit <a href='https://cbpf.data.unocha.org'>cbpf.data.unocha.org</a>"),Me.append("div").attr("class","d3chartFooterText").html(e)}function ie(){X.style("opacity",0).style("pointer-events","none");let e=A.append("div").attr("class","pbiobeOverDivHelp"),a=Mt.node().getBoundingClientRect(),n=window.getComputedStyle(Mt.node()),l=At.node().getBoundingClientRect(),t=bt.node().getBoundingClientRect(),o=X.node().getBoundingClientRect(),d=t.height*(y/t.width),D=(a.height+l.height+parseInt(n["margin-top"])+parseInt(n["margin-bottom"]))*(y/t.width),Y=e.append("svg").attr("viewBox","0 0 "+y+" "+(et+d+D)),R=[{text:"CLOSE",width:90},{text:"GO TO HELP PORTAL",width:180}],F=Y.selectAll(null).data(R).enter().append("g");F.append("rect").attr("rx",4).attr("ry",4).style("stroke","rgba(0, 0, 0, 0.3)").style("stroke-width","1px").style("fill",ge).style("cursor","pointer").attr("y",6).attr("height",22).attr("width",function(i){return i.width}).attr("x",function(i,h){return y-p[1]-i.width-(h?R[0].width+8:0)}).on("click",function(i,h){X.style("opacity",1).style("pointer-events","all"),e.remove(),h&&window.open(ve,"help_portal")}),F.append("text").attr("class","pbiobeAnnotationMainText").attr("text-anchor","middle").attr("x",function(i,h){return y-p[1]-i.width/2-(h?R[0].width+8:0)}).attr("y",22).text(function(i){return i.text}),[{x:60,y:d+(D-l.height)*(t.width/y),width:y-80,height:l.height*(y/t.width),xTooltip:300*(t.width/y),yTooltip:(d+D+8)*(t.width/y),text:"Use these checkboxes to select the CBPF. A disabled checkbox means that the correspondent CBPF has no data for that year."},{x:60,y:76+d+D,width:440,height:30,xTooltip:120*(t.width/y),yTooltip:(d+D+112)*(t.width/y),text:"Use these buttons to select year. Double click or press ALT when clicking to select multiple years"},{x:6,y:152+d+D,width:402,height:360,xTooltip:416*(t.width/y),yTooltip:(d+D+242)*(t.width/y),text:"The blue bars represent the percentage of actually affected persons. Real numbers of actually affected and targeted affected persons can be seen at the right-hand side of each bar."},{x:442,y:152+d+D,width:452,height:360,xTooltip:138*(t.width/y),yTooltip:(d+D+242)*(t.width/y),text:"The pictograms represent the real proportions of actually affected and targeted affected persons, for each category. The number on the bottom indicates how many people (approximately) a single pictogram represents."}].forEach(function(i){Y.append("rect").attr("rx",4).attr("ry",4).attr("x",i.x).attr("y",i.y).attr("width",i.width).attr("height",i.height).style("stroke",Ct).style("stroke-width","3px").style("fill","none").style("opacity",.5).attr("class","pbiobeHelpRectangle").attr("pointer-events","all").on("mouseover",function(){let h=this;mt(i.xTooltip,i.yTooltip,i.text,h)}).on("mouseout",$)});let tt=Y.append("rect").attr("x",y/2-180).attr("y",180+d+D).attr("width",360).attr("height",50).attr("pointer-events","none").style("fill","white").style("stroke","#888"),pt=Y.append("text").attr("class","pbiobeAnnotationExplanationText").attr("font-family","Roboto").attr("font-size","18px").style("fill","#222").attr("text-anchor","middle").attr("x",y/2).attr("y",200+d+D).attr("pointer-events","none").text("Hover over the elements surrounded by a blue rectangle to get additional information").call(He,350);function mt(i,h,s,x){pt.style("opacity",0),tt.style("opacity",0),Y.selectAll(".pbiobeHelpRectangle").style("opacity",.1),d3.select(x).style("opacity",1);let k=A.node().getBoundingClientRect();q.style("top",h+"px").style("left",i+"px").style("display","block").html(s)}function $(){q.style("display","none"),pt.style("opacity",1),tt.style("opacity",1),Y.selectAll(".pbiobeHelpRectangle").style("opacity",.5)}}function He(e,a){e.each(function(){let n=d3.select(this),l=n.text().split(/\s+/).reverse(),t,o=[],d=0,D=1.1,Y=n.attr("y"),R=n.attr("x"),F=0,L=n.text(null).append("tspan").attr("x",R).attr("y",Y).attr("dy",F+"em");for(;t=l.pop();)o.push(t),L.text(o.join(" ")),L.node().getComputedTextLength()>a&&(o.pop(),L.text(o.join(" ")),o=[t],L=n.append("tspan").attr("x",R).attr("y",Y).attr("dy",++d*D+F+"em").text(t))})}function je(e){e.split(",").map(function(n){return+n.trim()}).sort(function(n,l){return n-l}).forEach(function(n){n&&B.indexOf(n)>-1&&r.selectedYear.push(n)}),r.selectedYear.length||r.selectedYear.push(B[B.length-1])}function re(e){if(B.indexOf(e)>-1)return e;for(;B.indexOf(e)===-1;)e=e>=Rt?e-1:e+1;return e}function Ne(e){let a=[],n=e.split(",").map(function(t){return t.trim().toLowerCase()});return n.some(function(t){return We(d3.values(E)).indexOf(t)===-1})?d3.keys(E):(n.forEach(function(t){for(var o in E)E[o].toLowerCase()===t&&a.push(o)}),a)}function We(e){let a=[];for(let n in e)a.push(e[n].toLowerCase());return a}function le(e){return e[0].toUpperCase()+e.substring(1)}function rt(e){let a=(~~Math.log10(e)+1)%3,n=a===1?2:a===2?1:0,l=d3.formatPrefix("."+n+"~",e)(e);if(parseInt(l)===1e3){let t=l[l.length-1],o={k:"M",M:"B"};return 1+(isNaN(t)?o[t]:"")}return l}function Tt(e){let a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"transform",e);let n=a.transform.baseVal.consolidate().matrix;return[n.e,n.f]}function se(){Ye.html(function(){return r.selectedYear.length===1?null:"*Selected years: "+r.selectedYear.sort(function(a,n){return a-n}).reduce(function(a,n,l){return a+(l>=r.selectedYear.length-2?l>r.selectedYear.length-2?n:n+" and ":n+", ")},"")})}function Ue(e,a,n){e===a?ee.style("display","none").html(null):ee.style("display","block").html(`<p class="text-center" style="font-size:11px; color:#aaa; padding-top: 5px; margin:0"><b>(2) Disclaimer:</b> Figures for people targeted are based on projects with people reached. Total targeted people for the period is ${rt(a)}, for which reached people represents ${ot(n)}.<br></p>`)}function Bt(e,a){if(zt){alert("This functionality is not supported by Internet Explorer");return}let l=d3.select("body").append("div").style("position","fixed").attr("id","pbiobeDownloadingDiv").style("left",window.innerWidth/2-100+"px").style("top",window.innerHeight/2-100+"px").append("svg").attr("class","pbiobeDownloadingDivSvg").attr("width",200).attr("height",100),t="Downloading "+e.toUpperCase();ce(l,200,175,t);let o=S.node().getBoundingClientRect();S.attr("width",o.width).attr("height",o.height);let d=["font-size","font-family","font-weight","fill","stroke","stroke-dasharray","stroke-width","opacity","text-anchor","text-transform","shape-rendering","letter-spacing","white-space"],D=A.node();Y(S.node()),e==="png"?X.style("opacity",0):bt.style("opacity",0),ct.style("display","none"),html2canvas(D).then(function(R){S.attr("width",null).attr("height",null),e==="png"?X.style("opacity",1):bt.style("opacity",1),e==="png"?Ze(R):_e(R),a&&st&&d3.select(st).dispatch("mouseout")});function Y(R){if(!R.style)return;let F=getComputedStyle(R);for(let L=0;L<d.length;L++)R.style[d[L]]=F[d[L]];for(let L=0;L<R.childNodes.length;L++)Y(R.childNodes[L])}}function Ze(e){let n="AffectedPersons_"+Ft(new Date)+".png";e.toBlob(function(l){let t=URL.createObjectURL(l),o=document.createElement("a");o.download!==void 0?(o.setAttribute("href",t),o.setAttribute("download",n),o.style="visibility:hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)):window.location.href=t}),Et(),d3.select("#pbiobeDownloadingDiv").remove()}function _e(e){let a={top:10,bottom:16,left:20,right:30};d3.image("https://raw.githubusercontent.com/CBPFGMS/cbpfgms.github.io/master/img/assets/bilogo.png").then(function(n){let l,t=new jsPDF;pt();let o=t.splitTextToSize("CBPF receives broad support from United Nations Member States, the private sectors and individuals.",210-a.left-a.right,{fontSize:12}),d=d3.timeFormat("%A, %d %B %Y")(new Date);t.setTextColor(60),t.setFont("helvetica"),t.setFontType("normal"),t.setFontSize(12),t.text(a.left,48,o),t.setTextColor(65,143,222),t.setFont("helvetica"),t.setFontType("bold"),t.setFontSize(16),t.text(te,a.left,65),t.setFontSize(12);let D=r.selectedYear.sort(function($,i){return $-i}).reduce(function($,i,h){return $+(h>=r.selectedYear.length-2?h>r.selectedYear.length-2?i:i+" and ":i+", ")},""),Y=r.selectedYear.length>1?"Selected years: ":"Selected year: ",R=mt();t.fromHTML("<div style='margin-bottom: 2px; font-family: Arial, sans-serif; color: rgb(60, 60 60);'>Date: <span style='color: rgb(65, 143, 222); font-weight: 700;'>"+d+"</span></div><div style='margin-bottom: 2px; font-family: Arial, sans-serif; color: rgb(60, 60 60);'>"+Y+"<span style='color: rgb(65, 143, 222); font-weight: 700;'>"+D+"</span></div><div style='margin-bottom: 2px; font-family: Arial, sans-serif; color: rgb(60, 60 60);'>"+R.split("-")[0]+": <span style='color: rgb(65, 143, 222); font-weight: 700;'>"+R.split("-")[1]+"</span></div>",a.left,70,{width:210-a.left-a.right},function($){l=$});let F=A.node().getBoundingClientRect(),L=210-a.left*2;t.addImage(e,"PNG",a.left,l.y+2,L,L*(F.height/F.width));let tt=new Date;t.save("AffectedPersons_"+Ft(tt)+".pdf"),Et(),d3.select("#pbiobeDownloadingDiv").remove();function pt(){let $="\xA9 OCHA CBPF Section "+Rt+" | For more information, please visit cbpf.data.unocha.org";t.setFillColor(65,143,222),t.rect(0,a.top,210,15,"F"),t.setFillColor(236,161,84),t.rect(0,a.top+15,210,2,"F"),t.setFillColor(255,255,255),t.rect(a.left,a.top-1,94,20,"F"),t.ellipse(a.left,a.top+9,5,9,"F"),t.ellipse(a.left+94,a.top+9,5,9,"F"),t.addImage(n,"PNG",a.left+2,a.top,90,18),t.setFillColor(236,161,84),t.rect(0,297-a.bottom,210,2,"F"),t.setTextColor(60),t.setFont("arial"),t.setFontType("normal"),t.setFontSize(10),t.text($,a.left,297-a.bottom+10)}function mt(){let $=r.selectedCbpfs.length===1?"":"s",i=r.selectedCbpfs.map(function(h){return E[h]}).sort(function(h,s){return h.toLowerCase()<s.toLowerCase()?-1:h.toLowerCase()>s.toLowerCase()?1:0}).reduce(function(h,s,x){return h+(x>=r.selectedCbpfs.length-2?x>r.selectedCbpfs.length-2?s:s+" and ":s+", ")},"");return"Selected CBPF"+$+"-"+i}})}function ce(e,a,n,l){let t=e.append("g").attr("class","pbiobed3chartwheelGroup").attr("transform","translate("+a/2+","+n/4+")"),o=t.append("text").attr("text-anchor","middle").style("font-family","Roboto").style("font-weight","bold").style("font-size","11px").attr("y",50).attr("class","contributionColorFill").text(l),d=d3.arc().outerRadius(25).innerRadius(20),D=t.append("path").datum({startAngle:0,endAngle:0}).classed("contributionColorFill",!0).attr("d",d);Y();function Y(){D.transition().duration(1e3).attrTween("d",function(F){let L=d3.interpolate(0,Math.PI*2);return function(tt){return F.endAngle=L(tt),d(F)}}).on("end",R)}function R(){D.transition().duration(1e3).attrTween("d",function(F){let L=d3.interpolate(0,Math.PI*2);return function(tt){return F.startAngle=L(tt),d(F)}}).on("end",function(F){F.startAngle=0,Y()})}}function Et(){let e=d3.select(".pbiobed3chartwheelGroup");e.select("path").interrupt(),e.remove()}}})();})();
