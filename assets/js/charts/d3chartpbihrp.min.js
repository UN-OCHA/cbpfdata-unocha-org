(()=>{(function(){let _t=window.navigator.userAgent.indexOf("MSIE")>-1||window.navigator.userAgent.indexOf("Trident")>-1,Gt=window.fetch,Et=window.URLSearchParams,Me=window.matchMedia("(pointer: coarse)").matches&&!window.matchMedia("(any-pointer: fine)").matches,le=window.location.hostname==="cbpf.data.unocha.org",Ge=window.location.hostname+window.location.pathname==="cbpf.data.unocha.org/bookmark.html",pe="https://use.fontawesome.com/releases/v5.6.3/css/all.css",Ee=["https://cbpfgms.github.io/css/d3chartstyles.css","https://cbpfgms.github.io/css/d3chartstylespbihrp.css",pe],St="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js",ce="https://cbpfgms.github.io/libraries/html2canvas.min.js",de="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js",It="https://cdn.jsdelivr.net/npm/@ungap/url-search-params@0.1.2/min.min.js",ue="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js",he="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.4/fetch.min.js";if(Ee.forEach(function(R){if(!Ie(R)){let u=document.createElement("link");u.setAttribute("rel","stylesheet"),u.setAttribute("type","text/css"),u.setAttribute("href",R),R===pe&&(u.setAttribute("integrity","sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"),u.setAttribute("crossorigin","anonymous")),document.getElementsByTagName("head")[0].appendChild(u)}}),!Ut(St))Gt&&Et?st(St,Ct):Gt&&!Et?st(It,function(){st(St,Ct)}):st(ue,function(){st(he,function(){st(It,function(){st(St,Ct)})})});else if(typeof d3<"u")Gt&&Et?Ct():Gt&&!Et?st(It,Ct):st(ue,function(){st(he,function(){st(It,Ct)})});else{let R,u=document.getElementsByTagName("script");for(let nt=u.length;nt--;)u[nt].src==St&&(R=u[nt]);R.addEventListener("load",Ct)}function st(R,u){let nt=document.getElementsByTagName("head")[0],X=document.createElement("script");X.type="text/javascript",X.src=R,X.onreadystatechange=u,X.onload=u,nt.appendChild(X)}function Ie(R){let u=document.getElementsByTagName("link");for(let nt=u.length;nt--;)if(u[nt].href==R)return!0;return!1}function Ut(R){let u=document.getElementsByTagName("script");for(let nt=u.length;nt--;)if(u[nt].src==R)return!0;return!1}function Ct(){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(n){if(this==null)throw new TypeError('"this" is null or not defined');var o=Object(this),a=o.length>>>0;if(typeof n!="function")throw new TypeError("predicate must be a function");for(var e=arguments[1],l=0;l<a;){var d=o[l];if(n.call(e,d,l,o))return d;l++}},configurable:!0,writable:!0}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(n,o,a){var e=this.toDataURL(o,a).split(",")[1];setTimeout(function(){for(var l=atob(e),d=l.length,P=new Uint8Array(d),g=0;g<d;g++)P[g]=l.charCodeAt(g);n(new Blob([P],{type:o||"image/png"}))})}});let R=1100,u=[12,8,4,8],nt=6,X=12,fe=36,$t="pbihrp",ze=fe,Oe=80,Ye=94,qe=58,Ft=50,zt=50,Q=12,Rn=.85,Ot=.2,kn=-2,A=1e3,yt=10,Bt=16,ht=3,Jt=10,ge=6,je=8,be=12,We=12,At=d3.format(".0%"),Zt=d3.format(".2%"),_e=d3.format(",.0f"),Yt="#1F69B3",K=["#1175BA","#9BB9DF","#AFAFAF","#E9EAEB"],Ue="#F79A3B",Kt=["cbpffunding","cbpftarget","hrpfunding","hrprequirements"],qt=[82,282],$e=["HRP","CBPF"],Je=["TARGET","CBPF"],bt=16,Ze=window.innerHeight,Qt=new Date,me=Qt.getFullYear(),Ke=6e5,J=d3.local(),Qe="CBPF Target vs HRP",Xe="cbpfvshrp",tn="https://cbpf.data.unocha.org/bookmark.html?",en="https://gms.unocha.org/content/cbpf-vs-hrp-cbpf-funding-target-and-hrp-funding",Xt=d3.utcFormat("_%Y%m%d_%H%M%S_UTC"),Dt={cbpffunding:"CBPF Funding",cbpfpercentage:"CBPF Percentage of the Target Achieved",hrpfunding:"HRP Funding",hrprequirements:"HRP Requirements",cbpftarget:"CBPF Target",alphabetically:"Alphabetically"},Hn=["HRP Requirements","HRP Funding","CBPF Funding"],te=Object.keys(Dt),nn="https://cbpfapi.unocha.org/vo2/odata/HRPCBPFFundingSummary?PoolfundCodeAbbrv=&$format=csv",an="https://cbpfgms.github.io/pfbi-data/mst/MstRhpf.json",ye=[],ee=["70","62"],rn=" (*50% out of total HRP funding)",Sn={},V={selectedYear:null,sortBy:null},xt=!1,ft=600,j,ne="15%",Pt,at=new URLSearchParams(location.search);at.has("viz")||at.append("viz",Xe);let M=d3.select("#d3chartcontainerpbihrp"),on=M.node().getAttribute("data-showhelp")==="true",sn=M.node().getAttribute("data-showlink")==="true",xe=M.node().getAttribute("data-title")?M.node().getAttribute("data-title"):Qe,Pe=M.node().getAttribute("data-responsive")==="true",ln=M.node().getAttribute("data-lazyload")==="true",pn=at.has("year")?at.get("year"):M.node().getAttribute("data-year");V.sortBy=at.has("sortby")&&te.indexOf(at.get("sortby").replace(" ","").toLowerCase())>-1?at.get("sortby").replace(" ","").toLowerCase():te.indexOf(M.node().getAttribute("data-sortby").replace(" ","").toLowerCase())>-1?M.node().getAttribute("data-sortby").replace(" ","").toLowerCase():"cbpffunding";let ve=+M.node().getAttribute("data-firstyear"),we=+M.node().getAttribute("data-lastyear");V.sortBy==="cbpftarget"&&(V.sortBy="hrpfunding"),Pe||M.style("width",R+"px").style("height",ft+"px");let Nt=M.append("div").attr("class","pbihrpTopDiv"),cn=Nt.append("div").attr("class","pbihrpTitleDiv"),gt=Nt.append("div").attr("class","pbihrpIconsDiv d3chartIconsDiv"),O=M.append("svg").attr("viewBox","0 0 "+R+" "+ft).style("background-color","white");_t&&O.attr("height",ft);let dn=le?null:M.append("div").attr("class","pbihrpFooterDiv");Ne(O,R,ft,"Loading visualisation...");let Rt=M.append("div").attr("id","pbihrpSnapshotTooltip").attr("class","pbihrpSnapshotContent").style("display","none").on("mouseleave",function(){xt=!1,Rt.style("display","none"),H.style("display","none"),Pt&&d3.select(Pt).dispatch("mouseout")});Rt.append("p").attr("id","pbihrpSnapshotTooltipPdfText").html("Download PDF").on("click",function(){xt=!1,Wt("pdf",!0)}),Rt.append("p").attr("id","pbihrpSnapshotTooltipPngText").html("Download Image (PNG)").on("click",function(){xt=!1,Wt("png",!0)});let Ce=!Me&&(window.safari||window.navigator.userAgent.indexOf("Edge")>-1);Ce&&Rt.append("p").attr("id","pbihrpTooltipBestVisualizedText").html("For best results use Chrome, Firefox, Opera or Chromium-based Edge.").attr("pointer-events","none").style("cursor","default");let H=M.append("div").attr("id","pbihrptooltipdiv").style("display","none");M.on("contextmenu",function(){d3.event.preventDefault();let n=d3.mouse(this);xt=!0,Rt.style("display","block").style("top",n[1]-4+"px").style("left",n[0]-4+"px")});let c={main:O.append("g").attr("class","pbihrpbuttonsPanel").attr("transform","translate("+u[3]+","+u[0]+")"),width:(R-u[1]-u[3])/2,height:fe,padding:[0,0,6,0],buttonWidth:54,buttonPadding:4,buttonVerticalPadding:4,arrowPadding:18},ct={main:O.append("g").attr("class","pbihrpfundsNumberPanel").attr("transform","translate("+(u[3]+c.width+c.arrowPadding)+","+u[0]+")"),width:R-u[1]-u[3]-c.width,height:ze,padding:[0,0,0,0],textPadding:4},B={main:O.append("g").attr("class","pbihrptopSummaryPanel").attr("transform","translate("+u[3]+","+(u[0]+c.height+X)+")"),width:R-u[1]-u[3],height:Oe,titlePadding:30,padding:[0,0,0,0]},x={main:B.main.append("g").attr("class","pbihrptopSummaryPanelCbpf").attr("transform","translate(0,"+B.titlePadding+")"),width:B.width/2-nt,height:B.height-B.padding[0]-B.padding[2]-B.titlePadding,padding:[0,40,0,314],valuePadding:148,valueVerPadding:11},w={main:B.main.append("g").attr("class","pbihrptopSummaryPanelHrp").attr("transform","translate("+(B.width/2+X/2)+","+B.titlePadding+")"),width:B.width/2-nt,height:B.height-B.padding[0]-B.padding[2]-B.titlePadding,padding:[0,40,0,314],valuePadding:148,valueVerPadding:11},T={main:O.append("g").attr("class","pbihrpstackedBarPanel").attr("transform","translate("+u[3]+","+(u[0]+c.height+B.height+2*X)+")"),width:R-u[1]-u[3],height:Ye,padding:[20,2,26,0],labelPadding:10,labelHorPadding:8},S={main:O.append("g").attr("class","pbihrpdonutsPanel").attr("transform","translate("+u[3]+","+(u[0]+c.height+B.height+T.height+3*X)+")"),width:R-u[1]-u[3],height:qe,padding:[8,274,0,420],valuePadding:148,valueVerPadding:11},N={main:O.append("g").attr("class","pbihrpbarChartPanel").attr("transform","translate("+u[3]+","+(u[0]+c.height+B.height+T.height+S.height+6*X)+")"),width:R-u[1]-u[3],padding:[100,52,0,226],get mainAxisPadding(){return this.padding[3]-104},donutPadding:30,get titlePadding(){return this.padding[0]*.28},get legendPadding(){return this.padding[0]*.35}},L={main:O.append("g").attr("class","pbihrpnonHrpPanel"),width:R-u[1]-u[3],padding:[70,52,0,226],get mainAxisPadding(){return this.padding[3]-104},donutPadding:30,get titlePadding(){return this.padding[0]*.4},get legendPadding(){return this.padding[0]*.5}},lt={main:O.append("g").attr("class","pbihrpsortMenuPanel").attr("transform","translate("+u[3]+","+(u[0]+c.height+B.height+T.height+S.height+1.6*N.legendPadding+6*X)+")"),width:268,height:102,padding:[0,0,0,4],itemPadding:16,groupHeight:20,circleSize:6,innerCircleSize:3,leftPadding:58,groupPadding:18};T.main.attr("pointer-events","none"),S.main.attr("pointer-events","none");let kt=d3.arc().outerRadius((S.height-S.padding[0]-S.padding[2])/2-5).innerRadius((S.height-S.padding[0]-S.padding[2])/2-10),vt=d3.pie().value(function(n){return n.value}).sort(null),Be=d3.scalePoint().range([S.padding[3],S.width-S.padding[1]]),Lt=d3.scaleOrdinal().domain(Kt).range(K),pt=d3.scaleLinear().range([x.padding[3],x.width-x.padding[1]]),dt=d3.scaleLinear().range([T.padding[3],T.width-T.padding[1]]),Vt=d3.scaleBand(),ut=d3.scaleBand().domain($e).range([0,Ft]).paddingOuter(.75).paddingInner(.2),tt=d3.scaleLinear().range([N.padding[3],N.width-N.padding[1]]),jt=d3.scaleBand(),Ht=d3.scaleBand().domain(Je).range([0,zt]).paddingOuter(.75).paddingInner(.2),ae=d3.scaleLinear().range([L.padding[3],L.width-L.padding[1]]),un=d3.axisLeft(Vt),hn=d3.axisLeft(ut).tickSize(4),fn=d3.axisLeft(jt),gn=d3.axisLeft(Ht).tickSize(4),re=N.main.append("g").attr("class","pbihrpgroupYAxisBarChartMain").attr("transform","translate("+N.mainAxisPadding+",0)"),Dn=O.append("defs").append("marker").attr("id","pbihrparrowHead").attr("viewBox","0 -5 10 10").attr("refX",0).attr("refY",0).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("path").style("fill","#222").attr("d","M0,-5L5,0L0,5");Ut(ce)||st(ce,null),Ut(de)||st(de,null),Promise.all([Te("data",nn,"data","csv"),Te("masterRegionalFunds",an,"Regional funds master","json")]).then(n=>bn(n));function Te(n,o,a,e){if(localStorage.getItem(n)&&JSON.parse(localStorage.getItem(n)).timestamp>Qt.getTime()-Ke){let l=e==="csv"?d3.csvParse(JSON.parse(localStorage.getItem(n)).data):JSON.parse(localStorage.getItem(n)).data;return console.info($t+" chart info: "+a+" from local storage"),Promise.resolve(l)}else return(e==="csv"?d3.csv:d3.json)(o).then(d=>{try{localStorage.setItem(n,JSON.stringify({data:e==="csv"?d3.csvFormat(d):d,timestamp:Qt.getTime()}))}catch(P){console.info($t+" chart, "+P)}return console.info($t+" chart info: "+a+" from API"),d})}function bn([n,o]){se();let a=Pn(n);j=a.map(function(l){return l.year}).sort(function(l,d){return l-d}),vn(pn),ln?(d3.select(window).on("scroll.pbihrp",e),e()):Fe(a,o);function e(){let l=M.node().getBoundingClientRect();l.bottom<0||l.top-Ze>0||(d3.select(window).on("scroll.pbihrp",null),Fe(a,o))}}function Fe(n,o){let a=n.find(function(e){return e.year===V.selectedYear});Ae(a),mn(n),yn(j,n,o),Re(a.totalData,a.hrpYear),ke(a,o),He(a.totalData),Se(a.totalData,a.hrpYear),ie(a),oe(a),xn(n),le||Cn(),on&&De()}function Ae(n){let o=n.hrpData.length*Ft,a=n.nonHrpData.length*zt;N.height=N.padding[0]+o+N.padding[2],L.height=a?L.padding[0]+a+L.padding[2]:0,L.main.attr("transform","translate("+u[3]+","+(u[0]+c.height+B.height+T.height+S.height+N.height+7*X)+")"),ft=u[0]+c.height+B.height+T.height+S.height+N.height+L.height+7*X+u[2],Pe||M.style("width",R+"px").style("height",ft+"px"),_t?O.attr("viewBox","0 0 "+R+" "+ft).attr("height",ft):O.attr("viewBox","0 0 "+R+" "+ft)}function mn(n){let o=cn.append("p").attr("id","pbihrpd3chartTitle").html(xe),a=gt.append("button").attr("id","pbihrpHelpButton");a.html("HELP  ").append("span").attr("class","fas fa-info");let e=gt.append("button").attr("id","pbihrpDownloadButton");e.html(".CSV  ").append("span").attr("class","fas fa-download");let l=gt.append("div").attr("class","pbihrpSnapshotDiv");l.append("button").attr("id","pbihrpSnapshotButton").html("IMAGE ").append("span").attr("class","fas fa-camera");let P=l.append("div").attr("class","pbihrpSnapshotContent"),g=P.append("p").attr("id","pbihrpSnapshotPdfText").html("Download PDF").on("click",function(){Wt("pdf",!1)}),h=P.append("p").attr("id","pbihrpSnapshotPngText").html("Download Image (PNG)").on("click",function(){Wt("png",!1)}),p=gt.append("button").datum({clicked:!1}).attr("id","pbihrpPlayButton");if(p.html("PLAY  ").append("span").attr("class","fas fa-play"),p.on("click",function(r){r.clicked=!r.clicked,p.html(r.clicked?"PAUSE ":"PLAY  ").append("span").attr("class",r.clicked?"fas fa-pause":"fas fa-play"),r.clicked?(V.selectedYear.length=1,s(),timer=d3.interval(s,3*A)):timer.stop();function s(){let b=j.indexOf(V.selectedYear);if(V.selectedYear=j[(b+1)%j.length],d3.selectAll(".pbihrpbuttonsRects").filter(function(m){return m===V.selectedYear}).dispatch("click"),j.length>Q){let m=V.selectedYear<j[Q/2]?0:V.selectedYear>j[j.length-Q/2]?j.length-Q:j.indexOf(V.selectedYear)-Q/2,f=-(c.buttonWidth*m);f===0?(O.select(".pbihrpLeftArrowGroup").select("text").style("fill","#ccc"),O.select(".pbihrpLeftArrowGroup").attr("pointer-events","none")):(O.select(".pbihrpLeftArrowGroup").select("text").style("fill","#666"),O.select(".pbihrpLeftArrowGroup").attr("pointer-events","all")),Math.abs(f)>=(j.length-Q)*c.buttonWidth?(O.select(".pbihrpRightArrowGroup").select("text").style("fill","#ccc"),O.select(".pbihrpRightArrowGroup").attr("pointer-events","none")):(O.select(".pbihrpRightArrowGroup").select("text").style("fill","#666"),O.select(".pbihrpRightArrowGroup").attr("pointer-events","all")),O.select(".pbihrpbuttonsGroup").transition().duration(A).attrTween("transform",function(){return d3.interpolateString(this.getAttribute("transform"),"translate("+f+",0)")})}}}),!Ge){let r=gt.append("button").attr("id","pbihrpShareButton");r.html("SHARE  ").append("span").attr("class","fas fa-share");let s=M.append("div").attr("class","d3chartShareDiv").style("display","none");r.on("mouseover",function(){s.html("Click to copy").style("display","block");let b=this.getBoundingClientRect(),D=M.node().getBoundingClientRect(),m=s.node().getBoundingClientRect(),f=b.top-D.top-(m.height-b.height)/2,z=b.left-D.left-m.width-12;s.style("top",f+"px").style("left",z+"20px")}).on("mouseout",function(){s.style("display","none")}).on("click",function(){let b=tn+at.toString();s.append("input").attr("type","text").attr("readonly",!0).attr("spellcheck","false").property("value",b).node().select(),document.execCommand("copy"),s.html("Copied!");let m=this.getBoundingClientRect(),f=M.node().getBoundingClientRect(),z=s.node().getBoundingClientRect(),$=m.left-f.left-z.width-12;s.style("left",$+"20px")})}if(Ce){let r=P.append("p").attr("id","pbihrpBestVisualizedText").html("For best results use Chrome, Firefox, Opera or Chromium-based Edge.").attr("pointer-events","none").style("cursor","default")}l.on("mouseover",function(){P.style("display","block")}).on("mouseout",function(){P.style("display","none")}),a.on("click",De),e.on("click",function(){let r=n.find(function(f){return f.year===V.selectedYear}),s=wn(r),D="CBPFvsHRP_"+Xt(new Date)+".csv",m=new Blob([s],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(m,filename);else{let f=document.createElement("a");if(f.download!==void 0){let z=URL.createObjectURL(m);f.setAttribute("href",z),f.setAttribute("download",D),f.style="visibility:hidden",document.body.appendChild(f),f.click(),document.body.removeChild(f)}}})}function yn(n,o,a){let e=c.main.append("clipPath").attr("id","pbihrpclipPathButtons").append("rect").attr("width",Q*c.buttonWidth).attr("height",c.height-c.padding[2]),l=c.main.append("g").attr("class","pbihrpClipPathGroup").attr("transform","translate("+c.padding[3]+",0)").attr("clip-path","url(#pbihrpclipPathButtons)"),d=l.append("g").attr("class","pbihrpbuttonsGroup").attr("transform","translate(0,0)").style("cursor","pointer"),P=d.selectAll(null).data(j).enter().append("rect").attr("rx","2px").attr("ry","2px").attr("class","pbihrpbuttonsRects").attr("width",c.buttonWidth-c.buttonPadding).attr("height",c.height-c.padding[2]-c.buttonVerticalPadding*2).attr("y",c.buttonVerticalPadding).attr("x",function(C,G){return G*c.buttonWidth+c.buttonPadding/2}).style("fill",function(C){return V.selectedYear===C?Yt:"#eaeaea"}),g=d.selectAll(null).data(j).enter().append("text").attr("text-anchor","middle").attr("class","pbihrpbuttonsText").style("user-select","none").attr("y",(c.height-c.padding[2])/1.6).attr("x",function(C,G){return G*c.buttonWidth+c.buttonWidth/2}).style("fill",function(C){return V.selectedYear===C?"white":"#444"}).text(function(C){return C}),h=c.main.append("g").attr("class","pbihrpLeftArrowGroup").style("cursor","pointer").style("opacity",0).attr("pointer-events","none").attr("transform","translate("+c.padding[3]+",0)"),p=h.append("rect").style("fill","white").attr("width",c.arrowPadding).attr("height",c.height-c.padding[2]-c.padding[0]-c.buttonVerticalPadding*2).attr("y",c.buttonVerticalPadding),r=h.append("text").attr("class","pbihrpleftArrowText").attr("x",0).attr("y",c.height-c.padding[2]-c.buttonVerticalPadding*2.4).style("fill","#666").text("\u25C4"),s=c.main.append("g").attr("class","pbihrpRightArrowGroup").style("cursor","pointer").style("opacity",0).attr("pointer-events","none").attr("transform","translate("+(c.padding[3]+c.arrowPadding+Q*c.buttonWidth)+",0)"),b=s.append("rect").style("fill","white").attr("width",c.arrowPadding).attr("height",c.height-c.padding[2]-c.padding[0]-c.buttonVerticalPadding*2).attr("y",c.buttonVerticalPadding),D=s.append("text").attr("class","pbihrprightArrowText").attr("x",-1).attr("y",c.height-c.padding[2]-c.buttonVerticalPadding*2.4).style("fill","#666").text("\u25BA");j.length>Q&&(l.attr("transform","translate("+(c.padding[3]+c.arrowPadding)+",0)"),s.style("opacity",1).attr("pointer-events","all"),h.style("opacity",1).attr("pointer-events","all"),$(),z(),h.on("click",function(){h.attr("pointer-events","none");let C=Mt(d.attr("transform"))[0];s.select("text").style("fill","#666"),s.attr("pointer-events","all"),d.transition().duration(A).attr("transform","translate("+Math.min(0,C+Q*c.buttonWidth)+",0)").on("end",function(){Mt(d.attr("transform"))[0]===0?h.select("text").style("fill","#ccc"):h.attr("pointer-events","all")})}),s.on("click",function(){s.attr("pointer-events","none");let C=Mt(d.attr("transform"))[0];h.select("text").style("fill","#666"),h.attr("pointer-events","all"),d.transition().duration(A).attr("transform","translate("+Math.max(-((j.length-Q)*c.buttonWidth),-(Math.abs(C)+Q*c.buttonWidth))+",0)").on("end",function(){let G=Mt(d.attr("transform"))[0];Math.abs(G)>=(j.length-Q)*c.buttonWidth?s.select("text").style("fill","#ccc"):s.attr("pointer-events","all")})})),P.on("mouseover",m).on("mouseout",f).on("click",function(C){V.selectedYear=C,at.has("year")?at.set("year",C):at.append("year",C),P.style("fill",function(W){return V.selectedYear===W?Yt:"#eaeaea"}),g.style("fill",function(W){return V.selectedYear===W?"white":"#444"});let G=o.find(function(W){return W.year===V.selectedYear});Ae(G),Re(G.totalData,G.hrpYear),ke(G,a),He(G.totalData),Se(G.totalData,G.hrpYear),ie(G),oe(G)});function m(C){H.style("display","block").html(null),H.append("div").style("max-width","200px").attr("id","pbihrpInnerTooltipDiv").html("Click for selecting a single year. Multiple years selection is not possible.");let W=M.node().getBoundingClientRect(),i=this.getBoundingClientRect();tooltipSize=H.node().getBoundingClientRect(),H.style("left",i.left+i.width/2-W.left>W.width-tooltipSize.width/2-u[1]?W.width-tooltipSize.width-u[1]+"px":i.left+i.width/2-W.left<tooltipSize.width/2+c.padding[3]+u[0]?c.padding[3]+u[0]+"px":i.left+i.width/2-W.left-tooltipSize.width/2+"px").style("top",i.top+i.height/2-W.top<tooltipSize.height?i.top-W.top+i.height+2+"px":i.top-W.top-tooltipSize.height-4+"px"),d3.select(this).style("fill",Yt),d.selectAll("text").filter(function(v){return v===C}).style("fill","white")}function f(C){H.style("display","none"),V.selectedYear!==C&&(d3.select(this).style("fill","#eaeaea"),g.filter(function(G){return G===C}).style("fill","#444"))}function z(){let C=Mt(d.attr("transform"))[0];C===0&&(h.select("text").style("fill","#ccc"),h.attr("pointer-events","none")),Math.abs(C)>=(j.length-Q)*c.buttonWidth&&(s.select("text").style("fill","#ccc"),s.attr("pointer-events","none"))}function $(){let C=V.selectedYear<j[Q/2]?0:V.selectedYear>j[j.length-Q/2]?j.length-Q:j.indexOf(V.selectedYear)-Q/2;d.attr("transform","translate("+-(c.buttonWidth*C)+",0)")}}function Re(n,o){let a=d3.max(d3.values(n));pt.domain([0,a]);let e=B.main.selectAll(".pbihrptopSummaryPanelTitle").data([!0]).enter().append("text").attr("class","pbihrptopSummaryPanelTitle").attr("x",0).attr("y",B.titlePadding-10).text("Global target and funding"),l=B.main.selectAll(".pbihrptopSummaryPanelLine").data([!0]).enter().append("line").attr("class","pbihrptopSummaryPanelLine").attr("x1",0).attr("x2",B.width).attr("y1",B.titlePadding-3).attr("y2",B.titlePadding-3).style("stroke-width","2px").style("stroke",K[0]),d=B.main.selectAll(".pbihrptopSummaryPanelMiddleLine").data([!0]).enter().append("line").attr("class","pbihrptopSummaryPanelMiddleLine").attr("x1",B.width/2).attr("x2",B.width/2).attr("y1",B.titlePadding+8).attr("y2",B.height-8).style("stroke-width","1px").style("stroke","#ccc"),P=d3.select(".pbihrptopSummaryPanelCbpfValue").size()!==0?d3.select(".pbihrptopSummaryPanelCbpfValue").datum():0,g=d3.select(".pbihrptopSummaryPanelHrpValue").size()!==0?d3.select(".pbihrptopSummaryPanelHrpValue").datum():0,h=x.main.selectAll(".pbihrptopSummaryPanelCbpfValue").data([n.cbpftarget]);h=h.enter().append("text").attr("class","pbihrptopSummaryPanelCbpfValue contributionColorFill").attr("text-anchor","end").merge(h).attr("y",x.height-x.valueVerPadding).attr("x",x.valuePadding),h.transition().duration(A).tween("text",function(F){let E=this,I=d3.interpolate(P,F);return function(q){E.textContent="$"+_(I(q))}});let p=x.main.selectAll(".pbihrptopSummaryPanelCbpfTopText").data([!0]).enter().append("text").attr("class","pbihrptopSummaryPanelCbpfTopText").attr("x",x.valuePadding+3).attr("y",x.height-x.valueVerPadding*2.6).text("CBPF Target"),r=x.main.selectAll(".pbihrptopSummaryPanelCbpfBottomText").data([n.hrpfunding]);r=r.enter().append("text").attr("class","pbihrptopSummaryPanelCbpfBottomText").attr("x",x.valuePadding+3).attr("y",x.height-x.valueVerPadding*1.1).merge(r).text(function(F){return"("+ne+" of "+_(F)+")"});let s=w.main.selectAll(".pbihrptopSummaryPanelHrpValue").data([n.hrpfunding]);s=s.enter().append("text").attr("class","pbihrptopSummaryPanelHrpValue contributionColorFill").attr("text-anchor","end").merge(s).attr("y",w.height-w.valueVerPadding).attr("x",w.valuePadding),s.transition().duration(A).tween("text",function(F){let E=this,I=d3.interpolate(g,F);return function(q){E.textContent="$"+_(I(q))}});let b=w.main.selectAll(".pbihrptopSummaryPanelHrpTopText").data([!0]).enter().append("text").attr("class","pbihrptopSummaryPanelHrpTopText").attr("x",w.valuePadding+3).attr("y",w.height-w.valueVerPadding*2.6).text("HRP Funding"),D=w.main.selectAll(".pbihrptopSummaryPanelHrpBottomText").data([n.hrpfunding]);D=D.enter().append("text").attr("class","pbihrptopSummaryPanelHrpBottomText").attr("x",w.valuePadding+3).attr("y",w.height-w.valueVerPadding*1.1).merge(D).text(function(F){return"(for "+o+")"});let m=x.main.selectAll(".pbihrpcbpfTargetLabel").data([!0]).enter().append("text").attr("class","pbihrpcbpfTargetLabel").attr("x",x.padding[3]-4).attr("text-anchor","end").attr("y",x.height-x.valueVerPadding*2.7).text("Target"),f=x.main.selectAll(".pbihrpcbpfFundingLabel").data([!0]).enter().append("text").attr("class","pbihrpcbpfFundingLabel").attr("x",x.padding[3]-4).attr("text-anchor","end").attr("y",x.height-x.valueVerPadding*1.3).text("Funding"),z=w.main.selectAll(".pbihrphrpRequirementsLabel").data([!0]).enter().append("text").attr("class","pbihrphrpRequirementsLabel").attr("x",w.padding[3]-4).attr("text-anchor","end").attr("y",w.height-w.valueVerPadding*2.7).text("Requirements"),$=w.main.selectAll(".pbihrphrpFundingLabel").data([!0]).enter().append("text").attr("class","pbihrphrpFundingLabel").attr("x",w.padding[3]-4).attr("text-anchor","end").attr("y",w.height-w.valueVerPadding*1.3).text("Funding"),C=x.main.selectAll(".pbihrpcbpfTargetBar").data([n.cbpftarget]);C=C.enter().append("rect").attr("class","pbihrpcbpfTargetBar").attr("x",x.padding[3]).attr("y",x.height*.35-yt/2).attr("width",0).attr("height",yt).style("fill",K[1]).merge(C),C.transition().duration(A).attr("width",function(F){return pt(F)-x.padding[3]});let G=x.main.selectAll(".pbihrpcbpfFundingBar").data([n.cbpffunding]);G=G.enter().append("rect").attr("class","pbihrpcbpfFundingBar").attr("x",x.padding[3]).attr("y",x.height*.65-yt/2).attr("width",0).attr("height",yt).style("fill",K[0]).merge(G),G.transition().duration(A).attr("width",function(F){return pt(F)-x.padding[3]});let W=w.main.selectAll(".pbihrphrpRequirementsBar").data([n.hrprequirements]);W=W.enter().append("rect").attr("class","pbihrphrpRequirementsBar").attr("x",w.padding[3]).attr("y",w.height*.35-yt/2).attr("width",0).attr("height",yt).style("fill",K[3]).merge(W),W.transition().duration(A).attr("width",function(F){return pt(F)-w.padding[3]});let i=w.main.selectAll(".pbihrphrpFundingBar").data([n.hrpfunding]);i=i.enter().append("rect").attr("class","pbihrphrpFundingBar").attr("x",w.padding[3]).attr("y",w.height*.65-yt/2).attr("width",0).attr("height",yt).style("fill",K[2]).merge(i),i.transition().duration(A).attr("width",function(F){return pt(F)-w.padding[3]});let v=x.main.selectAll(".pbihrpcbpfTargetBarTick").data([!0]).enter().append("line").attr("class","pbihrpcbpfTargetBarTick").attr("x1",x.padding[3]-3).attr("x2",x.padding[3]).attr("y1",x.height*.35).attr("y2",x.height*.35).style("stroke","#888").style("stroke-width","1px"),et=x.main.selectAll(".pbihrpcbpfFundingBarTick").data([!0]).enter().append("line").attr("class","pbihrpcbpfFundingBarTick").attr("x1",x.padding[3]-3).attr("x2",x.padding[3]).attr("y1",x.height*.65).attr("y2",x.height*.65).style("stroke","#888").style("stroke-width","1px"),rt=w.main.selectAll(".pbihrphrpRequirementsBarTick").data([!0]).enter().append("line").attr("class","pbihrphrpRequirementsBarTick").attr("x1",w.padding[3]-3).attr("x2",w.padding[3]).attr("y1",w.height*.35).attr("y2",w.height*.35).style("stroke","#888").style("stroke-width","1px"),it=w.main.selectAll(".pbihrphrpFundingBarTick").data([!0]).enter().append("line").attr("class","pbihrphrpFundingBarTick").attr("x1",w.padding[3]-3).attr("x2",w.padding[3]).attr("y1",w.height*.65).attr("y2",w.height*.65).style("stroke","#888").style("stroke-width","1px"),Z=x.main.selectAll(".pbihrpcbpfTargetBarValue").data([n.cbpftarget]);Z=Z.enter().append("text").attr("class","pbihrpcbpfTargetBarValue").attr("y",x.height-x.valueVerPadding*2.7).attr("x",pt(0)+2).text(_(0)).merge(Z),Z.transition().duration(A).attr("x",function(F){return pt(F)+2}).tween("text",function(F){let E=this,I=d3.interpolate(mt(E.textContent.slice(1)),F);return function(q){E.textContent="$"+_(I(q))}});let t=x.main.selectAll(".pbihrpcbpfFundingBarValue").data([n.cbpffunding]);t=t.enter().append("text").attr("class","pbihrpcbpfFundingBarValue").attr("y",x.height-x.valueVerPadding*1.3).attr("x",pt(0)+2).text(_(0)).merge(t),t.transition().duration(A).attr("x",function(F){return pt(F)+2}).tween("text",function(F){let E=this,I=d3.interpolate(mt(E.textContent.slice(1)),F);return function(q){E.textContent="$"+_(I(q))}});let y=w.main.selectAll(".pbihrphrpRequirementsBarValue").data([n.hrprequirements]);y=y.enter().append("text").attr("class","pbihrphrpRequirementsBarValue").attr("y",w.height-w.valueVerPadding*2.7).attr("x",pt(0)+2).text(_(0)).merge(y),y.transition().duration(A).attr("x",function(F){return pt(F)+2}).tween("text",function(F){let E=this,I=d3.interpolate(mt(E.textContent.slice(1)),F);return function(q){E.textContent="$"+_(I(q))}});let k=w.main.selectAll(".pbihrphrpFundingBarValue").data([n.hrpfunding]);k=k.enter().append("text").attr("class","pbihrphrpFundingBarValue").attr("y",w.height-w.valueVerPadding*1.3).attr("x",pt(0)+2).text(_(0)).merge(k),k.transition().duration(A).attr("x",function(F){return pt(F)+2}).tween("text",function(F){let E=this,I=d3.interpolate(mt(E.textContent.slice(1)),F);return function(q){E.textContent="$"+_(I(q))}});let Y=B.main.selectAll(".pbihrpoverlayRectangle").data([!0]);Y=Y.enter().append("rect").attr("class","pbihrpoverlayRectangle").attr("width",B.width).attr("height",B.height+T.height+S.height+2*X).style("opacity",0).merge(Y),Y.on("mouseover",U).on("mousemove",ot).on("mouseout",wt);function U(){Pt=this;let F=B.height+T.height+S.height+2*X,E=d3.mouse(M.node()),I=d3.mouse(this);H.style("display","block").html(null);let q=[{title:"Total HRP Requirements",property:"hrprequirements"},{title:"Total HRP Funding",property:"hrpfunding"},{title:"Total CBPF Target",property:"cbpftarget"},{title:"Total CBPF Funding",property:"cbpffunding"}],Le=H.append("div").style("margin","0px").style("display","flex").style("flex-wrap","wrap").style("width","310px");q.forEach(function(Ve){Le.append("div").style("display","flex").style("flex","0 56%").html(Ve.title+":"),Le.append("div").style("display","flex").style("flex","0 44%").style("justify-content","flex-end").attr("class","contributionColorHTMLcolor").html("$"+_e(n[Ve.property]))});let Tt=H.node().getBoundingClientRect();J.set(this,Tt),H.style("top",I[1]<Tt.height/2?E[1]-I[1]+"px":I[1]<F-Tt.height/2?E[1]-Tt.height/2+"px":E[1]-(I[1]-(F-Tt.height))+"px").style("left",I[0]<B.width-12-Tt.width?E[0]+12+"px":E[0]-(I[0]-(B.width-Tt.width))+"px")}function ot(){let F=B.height+T.height+S.height+2*X,E=d3.mouse(M.node()),I=d3.mouse(this),q=J.get(this);H.style("top",I[1]<q.height/2?E[1]-I[1]+"px":I[1]<F-q.height/2?E[1]-q.height/2+"px":E[1]-(I[1]-(F-q.height))+"px").style("left",I[0]<B.width-12-q.width?E[0]+12+"px":E[0]-(I[0]-(B.width-q.width))+"px")}function wt(){xt||(currentHoveredRect=null,H.style("display","none"))}}function ke(n,o){let a=n.hrpData.filter(f=>!f.cbpfName.includes("RhPF")).length,e=n.nonHrpData.filter(f=>!f.cbpfName.includes("RhPF")).length,l=a+e,d=new Set;n.hrpData.forEach(function(f){if(f.cbpfName.includes("RhPF")){let z=f.cbpfName.split("(RhPF")[0].trim(),$=o.find(function(C){return C.RFundName.includes(z)});$&&d.add($.RFundAbbrv)}}),n.nonHrpData.forEach(function(f){if(f.cbpfName.includes("RhPF")){let z=f.cbpfName.split("(RhPF")[0].trim(),$=o.find(function(C){return C.RFundName.includes(z)});$&&d.add($.RFundAbbrv)}});let P=Array.from(d).length,g=d3.select(".pbihrptopValuesCbpfsNumber").size()!==0?d3.select(".pbihrptopValuesCbpfsNumber").datum():0,h=d3.select(".pbihrptopValuesRhpfsNumber").size()!==0?d3.select(".pbihrptopValuesRhpfsNumber").datum():0,p=ct.main.selectAll(".pbihrptopValuesCbpfsNumber").data(l?[l]:[]);p.exit().remove(),p=p.enter().append("text").attr("class","pbihrptopValuesCbpfsNumber contributionColorFill").attr("y",u[0]+c.height/2).attr("x",ct.width-qt[0]-ct.textPadding).merge(p),p.transition().duration(A).tween("text",function(f){let z=this,$=d3.interpolate(g,f);return function(C){z.textContent=~~$(C)}});let r=ct.main.selectAll(".pbihrptopValuesCbpfsText").data(l?[l]:[]);r.exit().remove(),r=r.enter().append("text").attr("class","pbihrptopValuesCbpfsText").attr("y",u[0]+c.height/2).attr("x",ct.width-qt[0]+ct.textPadding).merge(r).text(function(f){return f>1?"CBPFs":"CBPF"});let s=ct.main.selectAll(".pbihrptopValuesRhpfsNumber").data(P?[P]:[]);s.exit().remove(),s=s.enter().append("text").attr("class","pbihrptopValuesRhpfsNumber contributionColorFill").attr("y",u[0]+c.height/2).attr("x",ct.width-qt[1]-ct.textPadding).merge(s),s.transition().duration(A).tween("text",function(f){let z=this,$=d3.interpolate(h,f);return function(C){z.textContent=~~$(C)}});let b=ct.main.selectAll(".pbihrptopValuesRhpfsText").data(P?[P]:[]);b.exit().remove(),b=b.enter().append("text").attr("class","pbihrptopValuesRhpfsText").attr("y",u[0]+c.height/2).attr("x",ct.width-qt[1]+ct.textPadding).style("cursor","default").merge(b).text(function(f){return f>1?"Regional funds":"Regional fund"}),b.append("tspan").attr("class","pbihrpinfoIcon contributionColorFill").attr("dy","-8px").style("font-size","16px").text(" \uF05A"),b.on("mouseover",D).on("mouseout",m);function D(){let f=this.getBoundingClientRect().top-M.node().getBoundingClientRect().top+this.getBoundingClientRect().height+We;H.style("display","block").html(null);let z=[];n.hrpData.forEach($),n.nonHrpData.forEach($);function $(v){if(v.cbpfName.includes("RhPF")){let et=v.cbpfName.split("(RhPF")[0].trim(),rt=o.find(function(Z){return Z.RFundName.includes(et)}),it=z.find(function(Z){return Z.rfCode===rt.RFundAbbrv});it?it.funds.push(v.cbpfName):z.push({rfCode:rt.RFundAbbrv,rfName:rt.RFundTitle,funds:[v.cbpfName]})}}let G=H.append("div").style("max-width","300px").attr("id","pbihrpInnerTooltipDiv").selectAll(null).data(z).enter().append("div").attr("class","pbihrpFundsDiv");G.append("div").attr("class","pbihrpfundsDivTitle").html(function(v){return v.rfName}),G.append("div").html(function(v){return v.funds.length+(v.funds.length>1?" Country envelopes:":" Country envelope:")});let W=G.append("ul").selectAll(null).data(function(v){return v.funds}).enter().append("li").attr("class","pbihrpFundsList").html(function(v){return v}),i=H.node().getBoundingClientRect();H.style("top",f+"px").style("left",O.width-i.width+"px")}function m(){xt||H.style("display","none")}}function He(n){let o=T.main.selectAll(".pbihrpstackedBarPanelText").data([!0]).enter().append("text").attr("class","pbihrpstackedBarPanelText").attr("x",0).attr("y",T.padding[0]-5).text("CBPF and HRP values, to scale:"),a=d3.entries(n).sort(function(r,s){return s.value-r.value});dt.domain([0,a[0].value]);let e=T.main.selectAll(".pbihrpstackedBarsGroup").data(a,function(r){return r.key}),l=e.enter().append("g").attr("class","pbihrpstackedBarsGroup"),d=l.append("rect").attr("y",function(r,s){return T.padding[0]+s*(Bt/2)}).attr("x",dt(0)).attr("height",Bt).style("fill",function(r){return Lt(r.key)}).style("stroke","white").style("stroke-width","1px"),P=l.append("text").attr("class","pbihrpstackedBarsLabels").attr("x",dt(0)).attr("y",T.height-T.padding[2]+T.labelPadding).attr("font-family","Arial").attr("font-size","12px").attr("font-weight",700).text(_(0)),g=l.append("text").attr("class","pbihrpstackedBarsLabelsSpan").attr("font-family","Arial").attr("font-size","12px").attr("x",dt(0)).attr("y",T.height-T.padding[2]+T.labelPadding*2.3).text(function(r){return Dt[r.key]}),h=l.append("polyline").style("fill","none").style("stroke","#ccc").style("stroke-width","1px").attr("points",function(r,s){return dt(0)+","+(T.padding[0]+s*Bt/2+Bt)+" "+dt(0)+","+(T.height-T.padding[2]-4)+" "+dt(0)+","+(T.height-T.padding[2]-4)+" "+dt(0)+","+(T.height-T.padding[2])+" "});g.each(function(r,s,b){s||d3.select(this.parentNode).selectAll("text, tspan").attr("text-anchor","end"),J.set(this.parentNode,this.getBoundingClientRect().width)}),e=l.merge(e);let p=[];e.each(function(r){let s=J.get(this);p.unshift({key:r.key,position:dt(r.value),width:s})}),p.forEach(function(r,s,b){if(s&&s<b.length-1)for(r.position<b[s-1].position&&(r.position=b[s-1].position);r.position<b[s-1].position+b[s-1].width+T.labelHorPadding;)++r.position});for(let r=p.length-1;r--;)if(p[r].position>p[r+1].position&&(p[r].position=p[r+1].position),r===p.length-2)for(;p[r].position+p[r].width+T.labelHorPadding>p[r+1].position-p[r+1].width;)--p[r].position;else for(;p[r].position+p[r].width+T.labelHorPadding>p[r+1].position;)--p[r].position;e.select("rect").transition().duration(A).attr("y",function(r,s){return T.padding[0]+s*(Bt/2)}).attr("width",function(r){return dt(r.value)-T.padding[3]}),e.select("text.pbihrpstackedBarsLabels").transition().duration(A).attr("x",function(r,s,b){return p.find(function(D){return D.key===r.key}).position}).tween("text",function(r){let s=this,b=d3.interpolate(mt(s.textContent.slice(1)),r.value);return function(D){s.textContent="$"+_(b(D))}}),e.select("text.pbihrpstackedBarsLabelsSpan").transition().duration(A).attr("x",function(r,s,b){return p.find(function(D){return D.key===r.key}).position}),e.select("polyline").transition().duration(A).attr("points",function(r,s){let b=p.find(function(D){return D.key===r.key}).position;return dt(r.value)+","+(T.padding[0]+s*Bt/2+Bt)+" "+dt(r.value)+","+(T.height-T.padding[2]-4)+" "+b+","+(T.height-T.padding[2]-4)+" "+b+","+(T.height-T.padding[2])+" "})}function Se(n,o){let a=d3.select(".pbihrpdonutsPanelFundingValue").size()!==0?d3.select(".pbihrpdonutsPanelFundingValue").datum():0,e=S.main.selectAll(".pbihrpdonutsPanelFundingValue").data([n.cbpffunding]);e=e.enter().append("text").attr("class","pbihrpdonutsPanelFundingValue contributionColorFill").attr("text-anchor","end").merge(e).attr("y",S.height-S.valueVerPadding).attr("x",S.valuePadding),e.transition().duration(A).tween("text",function(m){let f=this,z=d3.interpolate(a,m);return function($){f.textContent="$"+_(z($))}});let l=S.main.selectAll(".pbihrpdonutsPanelTopText").data([!0]).enter().append("text").attr("class","pbihrpdonutsPanelTopText").attr("x",S.valuePadding+3).attr("y",S.height-S.valueVerPadding*2.6).text("Is the CBPF current").append("tspan").attr("x",S.valuePadding+3).attr("y",S.height-S.valueVerPadding*1.1).text("funding. It corresponds to..."),d=S.main.selectAll(".pbihrpdonutsPanelArrow").data([!0]).enter().append("text").attr("font-size","40px").attr("fill","#888").attr("font-family","Arial").attr("class","pbihrpdonutsPanelArrow").attr("y",S.height/1.3).attr("x",S.valuePadding+190).text("\u2192"),P=["cbpftarget","hrpfunding","hrprequirements"];Be.domain(P);let g=P.map(function(m){let f=[{key:"cbpffunding",value:n.cbpffunding},{key:m,value:n[m]-n.cbpffunding}];return{key:m,percent:n.cbpffunding/n[m],values:f}}),h=S.main.selectAll(".pbihrpdonutsGroup").data(g),p=h.enter().append("g").attr("class","pbihrpdonutsGroup").attr("transform",function(m){return"translate("+Be(m.key)+","+(S.padding[0]+S.height)/2+")"}),r=p.selectAll(null).data(function(m){return vt(m.values.map(function(f){return f.key==="cbpffunding"?{key:"cbpffunding",value:0}:f}))},function(m){return m.data.key}).enter().append("path").attr("class","pbihrpdonutsPaths").style("fill",function(m){return m.data.key==="cbpffunding"?K[0]:K[K.length-1]}).attr("d",kt).each(function(m){J.set(this,m)}),s=p.append("text").attr("class","pbihrpdonutsPercentage").attr("text-anchor","middle").attr("y",4).attr("x",0).text(At(0)),b=p.selectAll(null).data(function(m){return[m]}).enter().append("text").attr("class","pbihrpdonutsPanelDonutsText").attr("x",S.height/2).attr("y",-3).text(function(m){return m.key==="cbpftarget"?"of the current CBPF":m.key==="hrpfunding"?"of the HRP Funding":"of the HRP Requirements"}).append("tspan").attr("x",S.height/2).attr("y",12).text(function(m){return m.key==="cbpftarget"?"Target":"for "+o});h=p.merge(h),h.select(".pbihrpdonutsPercentage").transition().duration(A).tween("text",function(m){let f=this,z=+f.textContent.match(/\d+/)[0],$=d3.interpolate(z/100,m.percent);return function(C){f.textContent=At($(C))}}),h.select(".pbihrpdonutsPanelDonutsText tspan").text(function(m){return m.key==="cbpftarget"?"Target":"for "+o});let D=h.selectAll(".pbihrpdonutsPaths").data(function(m){return vt(m.values)},function(m){return m.data.key}).transition().duration(A).attrTween("d",function(m){let f=d3.interpolate(J.get(this),m);return J.set(this,f(0)),function(z){return kt(f(z))}})}function ie(n){let o=N.main.selectAll(".pbihrpbarChartPanelTitle").data([!0]).enter().append("text").attr("class","pbihrpbarChartPanelTitle").attr("x",0).attr("y",N.titlePadding-7).text("CBPF Target by Country"),a=N.main.selectAll(".pbihrpbarChartPanelLine").data([!0]).enter().append("line").attr("class","pbihrpbarChartPanelLine").attr("x1",0).attr("x2",N.width).attr("y1",N.titlePadding).attr("y2",N.titlePadding).style("stroke-width","2px").style("stroke",K[0]),e=N.main.selectAll(".pbihrplegendGroup").data(Kt.filter(function(t,y){return y!==1})).enter().append("g").attr("class","pbihrplegendGroup").attr("transform","translate(0,"+N.legendPadding+")"),l=e.append("rect").attr("width",bt).attr("height",bt).style("fill",function(t){return Lt(t)}),d=e.append("text").attr("y",bt-3).attr("x",bt+3).attr("class","pbihrplegendText").style("font-family","Arial").style("font-size","13px").text(function(t){return Dt[t.toLowerCase()]});if(e.size()){let t=0;e.each(function(E,I,q){I&&d3.select(this).attr("transform","translate("+(t+=this.previousSibling.getBoundingClientRect().width+26)+","+N.legendPadding+")")}),t+=e.nodes()[e.nodes().length-1].getBoundingClientRect().width+34;let y=8,k=[{value:.7},{value:.3}],Y=d3.arc().outerRadius(y+1).innerRadius(y-2),U=N.main.append("g").attr("transform","translate("+t+","+(N.legendPadding+8)+")"),ot=U.selectAll(null).data(vt(k)).enter().append("path").attr("d",Y).style("fill",function(E,I){return I?K[3]:K[0]}),wt=U.append("text").attr("class","pbihrplegendDonutText").attr("text-anchor","middle").attr("y",4).text("%"),F=U.append("text").attr("y",5).attr("x",y+3).attr("class","pbihrplegendText").style("font-family","Arial").style("font-size","13px").text("CBPF Funding as percentage of HRP Funding (blue circle relative to target)")}n.hrpData.sort(function(t,y){return V.sortBy==="alphabetically"?t.cbpfName.toLowerCase()<y.cbpfName.toLowerCase()?-1:t.cbpfName.toLowerCase()>y.cbpfName.toLowerCase()?1:0:y[V.sortBy]-t[V.sortBy]||(t.cbpfName.toLowerCase()<y.cbpfName.toLowerCase()?-1:t.cbpfName.toLowerCase()>y.cbpfName.toLowerCase()?1:0)});let P=n.hrpData.map(function(t){return t.cbpfName});Vt.domain(P).range([N.padding[0],N.height-N.padding[2]]),tt.domain([0,d3.max(n.hrpData,function(t){return Math.max(t.cbpffunding,t.hrpfunding,t.hrprequirements)})]);let g=N.main.selectAll(".pbihrpbarChartGroup").data(n.hrpData,function(t){return t.cbpfId}),h=g.exit().remove(),p=g.enter().append("g").attr("class","pbihrpbarChartGroup").attr("transform",function(t){return"translate(0,"+Vt(t.cbpfName)+")"}),r=p.append("g").attr("transform","translate("+(N.mainAxisPadding+N.donutPadding)+","+Ft/2+")"),s=r.selectAll(null).data(vt([{value:0},{value:1}])).enter().append("path").attr("class","pbihrpbarChartDonutsPaths").attr("d",kt).style("fill",function(t,y){return y?K[3]:K[0]}).each(function(t){J.set(this,t)}),b=r.append("text").attr("class","pbihrpbarChartDonutsPercentage").attr("text-anchor","middle").attr("y",4).attr("x",0).text(At(0)),D=p.append("g").attr("class","pbihrpgroupYAxisBarChartInner").attr("transform","translate("+N.padding[3]+",0)").call(hn).select(".domain").remove(),m=p.selectAll(null).data(function(t){return[{key:"cbpffunding",value:0},{key:"hrpfunding",value:0},{key:"hrprequirements",value:0}]},function(t){return t.key}).enter().append("rect").attr("class","pbihrpbarChartBars").style("fill",function(t){return Lt(t.key)}).attr("width",0).attr("height",ut.bandwidth()).attr("x",N.padding[3]).attr("y",function(t){return t.key==="cbpffunding"?ut("CBPF"):ut("HRP")}),f=p.append("line").attr("class","pbihrpbarChartLine").attr("x1",tt(0)).attr("x2",tt(0)).attr("y1",ut.paddingOuter()*ut.step()/4).attr("y2",Vt.bandwidth()-ut.paddingOuter()*ut.step()/1.5).style("stroke","#222").attr("stroke-dasharray","2, 2").attr("stroke-width","1px").attr("marker-start","url(#pbihrparrowHead)"),z=p.append("text").attr("class","pbihrpbarChartPercentageText").attr("y",je).attr("x",tt(0)+ge).text(ne),$=p.selectAll(null).data(function(t){return[{key:"cbpffunding",value:0}]}).enter().append("text").attr("class","pbihrpbarChartsLabelsBack").attr("x",N.padding[3]+ht).attr("y",ut("CBPF")+Jt).text(_(0)),C=p.selectAll(null).data(function(t){return[{key:"cbpffunding",value:0},{key:"hrpfunding",value:0},{key:"hrprequirements",value:0}]},function(t){return t.key}).enter().append("text").attr("class","pbihrpbarChartsLabels").attr("x",N.padding[3]+ht).attr("y",function(t){return(t.key==="cbpffunding"?ut("CBPF"):ut("HRP"))+Jt}).text(_(0)),G=p.append("rect").attr("class","pbihrptooltipRectangle").attr("height",Ft).attr("width",N.width).style("fill","none").attr("pointer-events","all").attr("cursor","pointer");g=p.merge(g),g.transition().duration(A).attr("transform",function(t){return"translate(0,"+Vt(t.cbpfName)+")"}),g.selectAll(".pbihrpbarChartDonutsPaths").data(function(t){return vt([{value:t.cbpfpercentage},{value:t.cbpfpercentage>1?0:1-t.cbpfpercentage}])}).transition().duration(A).attrTween("d",function(t){let y=d3.interpolate(J.get(this),t);return J.set(this,y(0)),function(k){return kt(y(k))}}),g.select(".pbihrpbarChartDonutsPercentage").transition().duration(A).tween("text",function(t){let y=this,k=+y.textContent.match(/\d+/)[0],Y=d3.interpolate(k/100,t.cbpftotalpercentage);return function(U){y.textContent=At(Y(U))}}),g.selectAll(".pbihrpbarChartBars").data(function(t){return[{key:"cbpffunding",value:t.cbpffunding},{key:"hrpfunding",value:t.hrpfunding},{key:"hrprequirements",value:t.hrprequirements}]},function(t){return t.key}).sort(function(t,y){return y.value-t.value}).transition().duration(A).attr("width",function(t){return tt(t.value)-N.padding[3]}),g.select(".pbihrpbarChartLine").transition().duration(A).attr("x1",function(t){return tt(t.cbpftarget)}).attr("x2",function(t){return tt(t.cbpftarget)}),g.select(".pbihrpbarChartPercentageText").text("Target: ").append("tspan").attr("class","pbihrpbarChartPercentageTextSpan").text(function(t){return _(t.cbpftarget)}).append("tspan").style("font-weight",400).text(function(t){return" ("+ne+" of "+_(t.hrpfunding)+")"}),g.select(".pbihrpbarChartPercentageText").transition().duration(A).attr("x",function(t){return tt(t.cbpftarget)+ge});let W=g.selectAll(".pbihrpbarChartsLabels").data(function(t){return[{key:"cbpffunding",value:t.cbpffunding},{key:"hrpfunding",value:t.hrpfunding},{key:"hrprequirements",value:t.hrprequirements}]},function(t){return t.key}).sort(function(t,y){return t.value-y.value}),i=W.filter(t=>t.key==="cbpffunding"),v=W.filter(t=>t.key!=="cbpffunding");i.transition().duration(A).attr("x",function(t,y){return tt(t.value)+ht}).tween("text",function(t,y){let k=this,Y=d3.interpolate(mt(k.textContent),t.value);return function(U){k.textContent=_(Y(U))}}),v.each(function(t,y){if(y===0){let k=d3.select(this.nextSibling).datum(),Y=g.append("text").style("opacity",0).style("font-family","Arial").style("font-size",10).style("font-weight",700).text(_(t.value)),U=Y.node().getBoundingClientRect().width,ot=Math.abs(tt(t.value)-tt(k.value))<U+1.5*ht;J.set(this,{size:U*(t.key==="hrpfunding"?2.45:2.1),move:ot}),Y.remove()}}).transition().duration(A).attr("x",function(t,y){return y===1&&J.get(this.previousSibling).move?tt(t.value)+2*ht+J.get(this.previousSibling).size:y===0&&J.get(this).move?tt(d3.select(this.nextSibling).datum().value)+ht:tt(t.value)+ht}).tween("text",function(t,y){let k="";y===0&&J.get(this).move&&(k=t.key==="hrpfunding"?" (fund.)/":" (req.)/"),y===1&&J.get(this.previousSibling).move&&(k=t.key==="hrpfunding"?" (fund.)":" (req.)");let Y=this,U=d3.interpolate(mt(Y.textContent.replace(k,"")),t.value);return function(ot){Y.textContent=_(U(ot))+k}}),g.selectAll(".pbihrpbarChartsLabelsBack").data(function(t){return[{key:"cbpffunding",value:t.cbpffunding}]}).transition().duration(A).attr("x",function(t){return tt(t.value)+ht}).tween("text",function(t){let y=this,k=d3.interpolate(mt(y.textContent),t.value);return function(Y){y.textContent=_(k(Y))}}),re.transition().duration(A).call(et);function et(t){let y=t.selection?t.selection():t;t.call(un),y.select(".domain").remove(),y.selectAll(".tick text").filter(function(k){return k.length>be}).text(k=>k.split(" ").slice(0,Math.ceil(k.split(" ").length/2)).join(" ")).attr("x",-9).attr("dy","-0.4em").append("tspan").attr("dy","1.2em").attr("x",-9).text(k=>k.split(" ").slice(Math.ceil(k.split(" ").length/2)).join(" ")),y!==t&&t.selectAll(".tick text").filter(function(k){return k.length>be}).attrTween("x",null).tween("text",null)}g.select(".pbihrptooltipRectangle").on("mouseover",it).on("mouseout",Z);function it(t){Pt=this;let y=this.parentNode;g.style("opacity",function(){return this===y?1:Ot}),re.selectAll(".tick").style("opacity",function(q){return q===t.cbpfName?1:Ot}),H.style("display","block").html(null);let k=[{title:"HRP Requirements",property:"hrprequirements"},{title:`HRP Funding${ee.includes(t.cbpfId)?rn:""}`,property:"hrpfunding"},{title:"CBPF Target",property:"cbpftarget"},{title:"CBPF Funding",property:"cbpffunding"}];H.append("div").style("margin-bottom","10px").style("font-size","16px").attr("class","contributionColorHTMLcolor").append("strong").html(t.cbpfName);let Y=H.append("div").style("margin","0px").style("display","flex").style("flex-wrap","wrap").style("width",ee.includes(t.cbpfId)?"400px":"300px");k.forEach(function(q){Y.append("div").style("display","flex").style("flex","0 75%").html(q.title+":"),Y.append("div").style("display","flex").style("flex","0 25%").style("justify-content","flex-end").attr("class","contributionColorHTMLcolor").html("$"+d3.formatPrefix(".2",t[q.property])(t[q.property]).replace("G","B"))}),H.append("div").style("margin-top","8px").html("The current CBPF Funding represents:<br>\u2192 "+Zt(t.cbpfpercentage)+" of the target<br>\u2192 "+Zt(t.cbpftotalpercentage)+" of the HRP Funding");let U=H.append("div").style("margin","0px").style("margin-top","8px").style("display","flex").style("flex-wrap","wrap").style("width",ee.includes(t.cbpfId)?"400px":"300px");U.append("div").style("display","flex").style("flex","0 75%").html("Remaining for the target:"),U.append("div").style("display","flex").style("flex","0 25%").style("justify-content","flex-end").attr("class","contributionColorHTMLcolor").html("$"+(t.cbpftarget-t.cbpffunding>0?d3.formatPrefix(".2",t.cbpftarget-t.cbpffunding)(t.cbpftarget-t.cbpffunding).replace("G","B"):"0.00"));let ot=this.getBoundingClientRect(),wt=M.node().getBoundingClientRect(),F=H.node().getBoundingClientRect(),E=ot.top-wt.top<wt.height-F.height-ot.height?ot.top-wt.top+2:ot.top-wt.top-F.height-ot.height-2,I=ot.left-wt.left+(ot.width-F.width)/2;H.style("top",E+Ft+"px").style("left",I+"px")}function Z(){xt||(currentHoveredRect=null,g.style("opacity",1),re.selectAll(".tick").style("opacity",1),H.style("display","none"))}}function oe(n){if(!n.nonHrpData.length){L.main.selectAll("*").remove();return}let o=L.main.selectAll(".pbihrpnonHrpPanelTitle").data([!0]).enter().append("text").attr("class","pbihrpnonHrpPanelTitle").attr("x",0).attr("y",L.titlePadding-7).text("Non-HRP CBPFs:"),a=L.main.selectAll(".pbihrpnonHrpPanelLine").data([!0]).enter().append("line").attr("class","pbihrpnonHrpPanelLine").attr("x1",0).attr("x2",L.width).attr("y1",L.titlePadding).attr("y2",L.titlePadding).style("opacity",.5).style("stroke-width","1px").style("stroke",K[0]),e=L.main.selectAll(".pbihrplegendGroupNonHrp").data(Kt.filter(function(i,v){return v!==2&&v!==3})).enter().append("g").attr("class","pbihrplegendGroupNonHrp").attr("transform","translate(0,"+L.legendPadding+")"),l=e.append("rect").attr("width",bt).attr("height",bt).style("fill",function(i){return Lt(i)}),d=e.append("text").attr("y",bt-3).attr("x",bt+3).attr("class","pbihrplegendText").style("font-family","Arial").style("font-size","13px").text(function(i){return Dt[i.toLowerCase()]});if(e.size()){let i=0;e.each(function(k,Y,U){Y&&d3.select(this).attr("transform","translate("+(i+=this.previousSibling.getBoundingClientRect().width+26)+","+L.legendPadding+")")}),i+=e.nodes()[e.nodes().length-1].getBoundingClientRect().width+34;let v=8,et=[{value:.7},{value:.3}],rt=d3.arc().outerRadius(v+1).innerRadius(v-2),it=L.main.append("g").attr("transform","translate("+i+","+(L.legendPadding+8)+")"),Z=it.selectAll(null).data(vt(et)).enter().append("path").attr("d",rt).style("fill",function(k,Y){return Y?K[3]:K[0]}),t=it.append("text").attr("class","pbihrplegendDonutText").attr("text-anchor","middle").attr("y",4).text("%"),y=it.append("text").attr("y",5).attr("x",v+3).attr("class","pbihrplegendText").style("font-family","Arial").style("font-size","13px").text("CBPF Funding as Percentage of the Target")}n.nonHrpData.sort(function(i,v){return V.sortBy==="alphabetically"?i.cbpfName.toLowerCase()<v.cbpfName.toLowerCase()?-1:i.cbpfName.toLowerCase()>v.cbpfName.toLowerCase()?1:0:V.sortBy==="cbpfpercentage"?v.cbpfpercentage-i.cbpfpercentage||(i.cbpfName.toLowerCase()<v.cbpfName.toLowerCase()?-1:i.cbpfName.toLowerCase()>v.cbpfName.toLowerCase()?1:0):v.cbpffunding-i.cbpffunding||(i.cbpfName.toLowerCase()<v.cbpfName.toLowerCase()?-1:i.cbpfName.toLowerCase()>v.cbpfName.toLowerCase()?1:0)});let P=n.nonHrpData.map(function(i){return i.cbpfName});jt.domain(P).range([L.padding[0],L.height-L.padding[2]]),ae.domain(tt.domain());let g=L.main.selectAll(".pbihrpgroupYAxisBarChartNonHrp").data([!0]).enter().append("g").attr("class","pbihrpgroupYAxisBarChartNonHrp").attr("transform","translate("+L.mainAxisPadding+",0)");L.main.select(".pbihrpgroupYAxisBarChartNonHrp").transition().duration(A).call(fn).selection().select(".domain").remove();let h=L.main.selectAll(".pbihrpbarChartGroupNonHrp").data(n.nonHrpData,function(i){return i.cbpfId}),p=h.exit().remove(),r=h.enter().append("g").attr("class","pbihrpbarChartGroupNonHrp").attr("transform",function(i){return"translate(0,"+jt(i.cbpfName)+")"}),s=r.append("g").attr("transform","translate("+(L.mainAxisPadding+L.donutPadding)+","+zt/2+")"),b=s.selectAll(null).data(vt([{value:0},{value:1}])).enter().append("path").attr("class","pbihrpbarChartDonutsPathsNonHrp").attr("d",kt).style("fill",function(i,v){return v?K[3]:K[0]}).each(function(i){J.set(this,i)}),D=s.append("text").attr("class","pbihrpbarChartDonutsPercentageNonHrp").attr("text-anchor","middle").attr("y",4).attr("x",0).text(At(0)),m=r.append("g").attr("class","pbihrpgroupYAxisBarChartNonHrpInner").attr("transform","translate("+L.padding[3]+",0)").call(gn).select(".domain").remove(),f=r.selectAll(null).data(function(i){return[{key:"cbpffunding",value:0},{key:"cbpftarget",value:0}]},function(i){return i.key}).enter().append("rect").attr("class","pbihrpbarChartBarsNonHrp").style("fill",function(i){return Lt(i.key)}).attr("width",0).attr("height",Ht.bandwidth()).attr("x",L.padding[3]).attr("y",function(i){return i.key==="cbpffunding"?Ht("CBPF"):Ht("TARGET")}),z=r.selectAll(null).data(function(i){return[{key:"cbpffunding",value:0},{key:"cbpftarget",value:0}]},function(i){return i.key}).enter().append("text").attr("class","pbihrpbarChartsLabelsNonHrp").attr("x",L.padding[3]+ht).attr("y",function(i){return(i.key==="cbpffunding"?Ht("CBPF"):Ht("TARGET"))+Jt}).text(_(0)),$=r.append("rect").attr("class","pbihrptooltipRectangleNonHrp").attr("height",zt).attr("width",L.width).style("fill","none").attr("pointer-events","all").attr("cursor","pointer");h=r.merge(h),h.transition().duration(A).attr("transform",function(i){return"translate(0,"+jt(i.cbpfName)+")"}),h.selectAll(".pbihrpbarChartDonutsPathsNonHrp").data(function(i){return vt([{value:i.cbpfpercentage},{value:i.cbpfpercentage>1?0:1-i.cbpfpercentage}])}).transition().duration(A).attrTween("d",function(i){let v=d3.interpolate(J.get(this),i);return J.set(this,v(0)),function(et){return kt(v(et))}}),h.select(".pbihrpbarChartDonutsPercentageNonHrp").transition().duration(A).tween("text",function(i){let v=i.cbpfpercentage<10?i.cbpfpercentage:9.99,et=this,rt=+et.textContent.match(/\d+/)[0],it=d3.interpolate(rt/100,v);return function(Z){et.textContent=At(it(Z))}}),h.selectAll(".pbihrpbarChartBarsNonHrp").data(function(i){return[{key:"cbpffunding",value:i.cbpffunding},{key:"cbpftarget",value:i.cbpftarget}]},function(i){return i.key}).transition().duration(A).attr("width",function(i){return ae(i.value)-L.padding[3]}),h.selectAll(".pbihrpbarChartsLabelsNonHrp").data(function(i){return[{key:"cbpffunding",value:i.cbpffunding},{key:"cbpftarget",value:i.cbpftarget}]},function(i){return i.key}).transition().duration(A).attr("x",function(i){return ae(i.value)+ht}).tween("text",function(i){let v=this,et=d3.interpolate(mt(v.textContent),i.value);return function(rt){v.textContent=_(et(rt))}}),h.select(".pbihrptooltipRectangleNonHrp").on("mouseover",G).on("mouseout",W);function G(i){Pt=this;let v=this.parentNode;h.style("opacity",function(){return this===v?1:Ot}),g.selectAll(".tick").style("opacity",function(U){return U===i.cbpfName?1:Ot}),H.style("display","block").html(null);let et=[{title:"CBPF Target",property:"cbpftarget"},{title:"CBPF Funding",property:"cbpffunding"}];H.append("div").style("margin-bottom","10px").style("font-size","16px").attr("class","contributionColorHTMLcolor").append("strong").html(i.cbpfName);let rt=H.append("div").style("margin","0px").style("display","flex").style("flex-wrap","wrap").style("width","300px");et.forEach(function(U){rt.append("div").style("display","flex").style("flex","0 56%").html(U.title+":"),rt.append("div").style("display","flex").style("flex","0 44%").style("justify-content","flex-end").attr("class","contributionColorHTMLcolor").html("$"+d3.formatPrefix(".2",i[U.property])(i[U.property]))}),H.append("div").style("margin-top","8px").html("The current CBPF Funding represents:<br>\u2192 "+Zt(i.cbpfpercentage)+" of the target");let it=H.append("div").style("margin","0px").style("margin-top","8px").style("display","flex").style("flex-wrap","wrap").style("width","300px");it.append("div").style("display","flex").style("flex","0 56%").html("Remaining for the target:"),it.append("div").style("display","flex").style("flex","0 44%").style("justify-content","flex-end").attr("class","contributionColorHTMLcolor").html("$"+(i.cbpftarget-i.cbpffunding>0?d3.formatPrefix(".2",i.cbpftarget-i.cbpffunding)(i.cbpftarget-i.cbpffunding).replace("G","B"):"0.00"));let Z=this.getBoundingClientRect(),t=M.node().getBoundingClientRect(),y=H.node().getBoundingClientRect(),k=Z.top-t.top<t.height-y.height-Z.height?Z.top-t.top+2:Z.top-t.top-y.height-Z.height-2,Y=Z.left-t.left+(Z.width-y.width)/2;H.style("top",k+Ft+"px").style("left",Y+"px")}function W(){xt||(currentHoveredRect=null,h.style("opacity",1),g.selectAll(".tick").style("opacity",1),H.style("display","none"))}}function xn(n){let o=lt.main.append("text").attr("class","pbihrpsortMenuTitle contributionColorDarkerFill").attr("x",0).attr("y",bt-1).text("Sort by:"),a=te.filter(function(g){return g!=="cbpftarget"}),e=lt.main.selectAll(null).data(a).enter().append("g").attr("cursor","pointer").attr("pointer-events","all"),l=e.append("text").attr("class","pbihrpsortGroupText").attr("x",lt.itemPadding).attr("y",lt.groupHeight/1.35).text(function(g){return Dt[g]}),d=e.append("circle").attr("class","pbihrpsortGroupsOuterCircle").attr("r",lt.circleSize).attr("cx",lt.circleSize).attr("cy",lt.groupHeight/2).style("fill","none").style("stroke","darkslategray"),P=e.append("circle").attr("class","pbihrpsortGroupsInnerCircle").attr("r",lt.innerCircleSize).attr("cx",lt.circleSize).attr("cy",lt.groupHeight/2).style("stroke","none").style("fill",function(g){return V.sortBy===g?"darkslategray":"none"});e.each(function(g,h){d3.select(this).attr("transform","translate("+(h?J.get(this.previousSibling):lt.leftPadding)+",0)"),J.set(this,this.getBBox().width+lt.groupPadding+(h?J.get(this.previousSibling):lt.leftPadding))}),e.on("click",function(g){V.sortBy=g,at.has("sortby")?at.set("sortby",g):at.append("sortby",g),P.style("fill",function(p){return V.sortBy===p?"darkslategray":"none"}),d3.select(Pt).dispatch("mouseleave");let h=n.find(function(p){return p.year===V.selectedYear});ie(h),oe(h)})}function Pn(n){let o=[];return n.forEach(function(a){if((!ve||!we||+a.TargYr>=ve&&+a.TargYr<=we)&&(a.ClstNm==="xxx"||a.ClstNm==="yyy")){ye.indexOf(a.PFId)===-1&&ye.push(a.PFId);let e={cbpfName:a.PFNm,cbpfId:a.PFId,cbpffunding:+a.PFFunded,cbpftarget:+a.PFHRPTarget,cbpfpercentage:+a.PFHRPTarget==0?0:+a.PFFunded/+a.PFHRPTarget,cbpftotalpercentage:+a.HRPClstFunded==0?0:+a.PFFunded/+a.HRPClstFunded,hrpfunding:+a.HRPClstFunded,hrprequirements:+a.HRPClstReq},l=o.find(function(d){return d.year===+a.TargYr});l?(l.totalData.cbpffunding+=+a.PFFunded,l.totalData.cbpftarget+=+a.PFHRPTarget,l.totalData.hrpfunding+=+a.HRPClstFunded,l.totalData.hrprequirements+=+a.HRPClstReq,a.ClstNm==="xxx"?l.hrpData.push(e):l.nonHrpData.push(e)):a.ClstNm==="xxx"?o.push({year:+a.TargYr,hrpYear:+a.HRPYr,totalData:{cbpffunding:+a.PFFunded,cbpftarget:+a.PFHRPTarget,hrpfunding:+a.HRPClstFunded,hrprequirements:+a.HRPClstReq},hrpData:[e],nonHrpData:[]}):o.push({year:+a.TargYr,hrpYear:+a.HRPYr,totalData:{cbpffunding:+a.PFFunded,cbpftarget:+a.PFHRPTarget,hrpfunding:+a.HRPClstFunded,hrprequirements:+a.HRPClstReq},hrpData:[],nonHrpData:[e]})}}),o}function vn(n){V.selectedYear=j.indexOf(+n)>-1?+n:j[j.length-1]}function Mt(n){let o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"transform",n);let a=o.transform.baseVal.consolidate().matrix;return[a.e,a.f]}function _(n){let o=(~~Math.log10(n)+1)%3,a=o===1?2:o===2?1:0,e=d3.formatPrefix("."+a+"~",n)(n).replace("G","B");if(parseInt(e)===1e3){let l=e[e.length-1],d={k:"M",M:"B"};return 1+(isNaN(l)?d[l]:"")}return e}function mt(n){if(+n==0)return 0;if(+n==+n)return+n;let o,a={Y:Math.pow(10,24),Z:Math.pow(10,21),E:Math.pow(10,18),P:Math.pow(10,15),T:Math.pow(10,12),G:Math.pow(10,9),B:Math.pow(10,9),M:Math.pow(10,6),k:Math.pow(10,3),h:Math.pow(10,2),da:Math.pow(10,1),d:Math.pow(10,-1),c:Math.pow(10,-2),m:Math.pow(10,-3),\u03BC:Math.pow(10,-6),n:Math.pow(10,-9),p:Math.pow(10,-12),f:Math.pow(10,-15),a:Math.pow(10,-18),z:Math.pow(10,-21),y:Math.pow(10,-24)};return Object.keys(a).some(function(e){if(n.indexOf(e)>0)return o=parseFloat(n.split(e)[0])*a[e],!0}),o}function wn(n){let o=n.hrpData.map(function(l){return{"CBPF Name":l.cbpfName,"CBPF Funding":l.cbpffunding,"CBPF Target":l.cbpftarget,"CBPF Funding as % of HRP Funding":~~(1e4*l.cbpftotalpercentage)/100,"HRP Funding":l.hrpfunding,"HRP Requirements":l.hrprequirements,"Has HRP?":"yes"}}),a=n.nonHrpData.map(function(l){return{"CBPF Name":l.cbpfName,"CBPF Funding":l.cbpffunding,"CBPF Target":l.cbpftarget,"CBPF Funding as % of HRP Funding":"n/a","HRP Funding":l.hrpfunding,"HRP Requirements":l.hrprequirements,"Has HRP?":"no"}});return o.push.apply(o,a),d3.csvFormat(o)}function De(){gt.style("opacity",0).style("pointer-events","none");let n=M.append("div").attr("class","pbihrpOverDivHelp"),o=Nt.node().getBoundingClientRect(),a=gt.node().getBoundingClientRect(),e=o.height*(R/o.width),l=n.append("svg").attr("viewBox","0 0 "+R+" "+(ft+e)),d=[{text:"CLOSE",width:90},{text:"GO TO HELP PORTAL",width:180}],P=l.selectAll(null).data(d).enter().append("g");P.append("rect").attr("rx",4).attr("ry",4).style("stroke","rgba(0, 0, 0, 0.3)").style("stroke-width","1px").style("fill",Ue).style("cursor","pointer").attr("y",6).attr("height",22).attr("width",function(b){return b.width}).attr("x",function(b,D){return R-u[1]-b.width-(D?d[0].width+8:0)}).on("click",function(b,D){gt.style("opacity",1).style("pointer-events","all"),n.remove(),D&&window.open(en,"help_portal")}),P.append("text").attr("class","pbihrpAnnotationMainText").attr("text-anchor","middle").attr("x",function(b,D){return R-u[1]-b.width/2-(D?d[0].width+8:0)}).attr("y",22).text(function(b){return b.text}),[{x:6,y:16+e,width:168,height:30,xTooltip:6*(o.width/R),yTooltip:(e+54)*(o.width/R),text:"Use these buttons to select the year. You can select only one year at a time."},{x:4,y:410+e,width:880,height:26,xTooltip:200*(o.width/R),yTooltip:(e+444)*(o.width/R),text:"Click these radio buttons to sort the Funds according to several variables."},{x:4,y:446+e,width:1080,height:60,xTooltip:200*(o.width/R),yTooltip:(e+390)*(o.width/R),text:"Hover over the bars to get detailed figures for each Fund."}].forEach(function(b){l.append("rect").attr("rx",4).attr("ry",4).attr("x",b.x).attr("y",b.y).attr("width",b.width).attr("height",b.height).style("stroke",Yt).style("stroke-width","3px").style("fill","none").style("opacity",.5).attr("class","pbihrpHelpRectangle").attr("pointer-events","all").on("mouseover",function(){let D=this;r(b.xTooltip,b.yTooltip,b.text,D)}).on("mouseout",s)});let h=l.append("rect").attr("x",R/2-180).attr("y",244).attr("width",360).attr("height",50).attr("pointer-events","none").style("fill","white").style("stroke","#888"),p=l.append("text").attr("class","pbihrpAnnotationExplanationText").attr("font-family","Roboto").attr("font-size","18px").style("fill","#222").attr("text-anchor","middle").attr("x",R/2).attr("y",264).attr("pointer-events","none").text("Hover over the elements surrounded by a blue rectangle to get additional information").call(Bn,350);function r(b,D,m,f){p.style("opacity",0),h.style("opacity",0),l.selectAll(".pbihrpHelpRectangle").style("opacity",.1),d3.select(f).style("opacity",1);let z=M.node().getBoundingClientRect();H.style("top",D+"px").style("left",b+"px").style("display","block").html(null),H.append("div").style("width","300px").html(m)}function s(){H.style("display","none"),p.style("opacity",1),h.style("opacity",1),l.selectAll(".pbihrpHelpRectangle").style("opacity",.5)}}function Cn(){let n="\xA9 OCHA CBPF Section "+me;sn&&(n+=" | For more information, please visit <a href='https://cbpf.data.unocha.org'>cbpf.data.unocha.org</a>"),dn.append("div").attr("class","d3chartFooterText").html(n)}function Bn(n,o){n.each(function(){let a=d3.select(this),e=a.text().split(/\s+/).reverse(),l,d=[],P=0,g=1.1,h=a.attr("y"),p=a.attr("x"),r=0,s=a.text(null).append("tspan").attr("x",p).attr("y",h).attr("dy",r+"em");for(;l=e.pop();)d.push(l),s.text(d.join(" ")),s.node().getComputedTextLength()>o&&(d.pop(),s.text(d.join(" ")),d=[l],s=a.append("tspan").attr("x",p).attr("y",h).attr("dy",++P*g+r+"em").text(l))})}function Wt(n,o){if(_t){alert("This functionality is not supported by Internet Explorer");return}let e=d3.select("body").append("div").style("position","fixed").attr("id","pbihrpDownloadingDiv").style("left",window.innerWidth/2-100+"px").style("top",window.innerHeight/2-100+"px").append("svg").attr("class","pbihrpDownloadingDivSvg").attr("width",200).attr("height",100),l="Downloading "+n.toUpperCase();Ne(e,200,175,l);let d=O.node().getBoundingClientRect();O.attr("width",d.width).attr("height",d.height);let P=["font-size","font-family","font-weight","fill","stroke","stroke-dasharray","stroke-width","opacity","text-anchor","text-transform","shape-rendering","letter-spacing","white-space"],g=M.node();h(O.node()),n==="png"?gt.style("opacity",0):Nt.style("opacity",0),Rt.style("display","none"),html2canvas(g).then(function(p){O.attr("width",null).attr("height",null),n==="png"?gt.style("opacity",1):Nt.style("opacity",1),n==="png"?Tn(p):Fn(p),o&&Pt&&d3.select(Pt).dispatch("mouseout")});function h(p){if(!p.style)return;let r=getComputedStyle(p);for(let s=0;s<P.length;s++)p.style[P[s]]=r[P[s]];for(let s=0;s<p.childNodes.length;s++)h(p.childNodes[s])}}function Tn(n){let a="CBPFvsHRP_"+Xt(new Date)+".png";n.toBlob(function(e){let l=URL.createObjectURL(e),d=document.createElement("a");d.download!==void 0?(d.setAttribute("href",l),d.setAttribute("download",a),d.style="visibility:hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)):window.location.href=l}),se(),d3.select("#pbihrpDownloadingDiv").remove()}function Fn(n){let o={top:10,bottom:16,left:20,right:30};d3.image("https://raw.githubusercontent.com/CBPFGMS/cbpfgms.github.io/master/img/assets/bilogo.png").then(function(a){let e,d=M.node().getBoundingClientRect(),P=210-o.left*2,g=P*(d.height/d.width),h=180,p;g>h?(p=297+g-h,e=new jsPDF({format:[210*2.834646,p*2.834646],unit:"mm"})):(p=297,e=new jsPDF);let r;m();let s=e.splitTextToSize("The Humanitarian Response Plan (HRP) plan is prepared for a protracted or sudden onset emergency that requires international humanitarian assistance. The graphs bellow portray how  CBPF funding is recorded against  an HRP having in mind the Secretary-General's vision to increase the  overall proportion of humanitarian appeal funding requirements channeled through CBPFs to 15% by 2019.",210-o.left-o.right,{fontSize:10}),b=d3.timeFormat("%A, %d %B %Y")(new Date);e.setTextColor(60),e.setFont("helvetica"),e.setFontType("normal"),e.setFontSize(10),e.text(o.left,48,s),e.setTextColor(65,143,222),e.setFont("helvetica"),e.setFontType("bold"),e.setFontSize(16),e.text(xe,o.left,75),e.setFontSize(12),e.fromHTML("<div style='margin-bottom: 2px; font-family: Arial, sans-serif; color: rgb(60, 60 60);'>Date: <span style='color: rgb(65, 143, 222); font-weight: 700;'>"+b+"</span></div><div style='margin-bottom: 2px; font-family: Arial, sans-serif; color: rgb(60, 60 60);'>Selected year: <span style='color: rgb(65, 143, 222); font-weight: 700;'>"+V.selectedYear+"</span></div>",o.left,80,{width:210-o.left-o.right},function(f){r=f}),e.addImage(n,"PNG",o.left,r.y+2,P,g);let D=new Date;e.save("CBPFvsHRP_"+Xt(D)+".pdf"),se(),d3.select("#pbihrpDownloadingDiv").remove();function m(){let f="\xA9 OCHA CBPF Section "+me+" | For more information, please visit cbpf.data.unocha.org";e.setFillColor(65,143,222),e.rect(0,o.top,210,15,"F"),e.setFillColor(236,161,84),e.rect(0,o.top+15,210,2,"F"),e.setFillColor(255,255,255),e.rect(o.left,o.top-1,94,20,"F"),e.ellipse(o.left,o.top+9,5,9,"F"),e.ellipse(o.left+94,o.top+9,5,9,"F"),e.addImage(a,"PNG",o.left+2,o.top,90,18),e.setFillColor(236,161,84),e.rect(0,p-o.bottom,210,2,"F"),e.setTextColor(60),e.setFont("arial"),e.setFontType("normal"),e.setFontSize(10),e.text(f,o.left,p-o.bottom+10)}})}function Ne(n,o,a,e){let l=n.append("g").attr("class","pbihrpd3chartwheelGroup").attr("transform","translate("+o/2+","+a/4+")"),d=l.append("text").attr("text-anchor","middle").style("font-family","Arial").style("font-weight","bold").style("font-size","11px").attr("y",50).attr("class","contributionColorFill").text(e),P=d3.arc().outerRadius(25).innerRadius(20),g=l.append("path").datum({startAngle:0,endAngle:0}).classed("contributionColorFill",!0).attr("d",P);h();function h(){g.transition().duration(1e3).attrTween("d",function(r){let s=d3.interpolate(0,Math.PI*2);return function(b){return r.endAngle=s(b),P(r)}}).on("end",p)}function p(){g.transition().duration(1e3).attrTween("d",function(r){let s=d3.interpolate(0,Math.PI*2);return function(b){return r.startAngle=s(b),P(r)}}).on("end",function(r){r.startAngle=0,h()})}}function se(){let n=d3.select(".pbihrpd3chartwheelGroup");n.select("path").interrupt(),n.remove()}}})();})();
